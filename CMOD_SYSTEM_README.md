# CHTL Cmodä½“ç³»å®ç°æ–‡æ¡£

## æ¦‚è¿°

CHTL Cmodä½“ç³»æ˜¯CHTLç¼–è¯‘å™¨çš„æ¨¡å—åŒ–ç³»ç»Ÿï¼Œæä¾›äº†å®Œæ•´çš„æ¨¡å—æ‰“åŒ…ã€åˆ†å‘å’Œå¯¼å…¥æœºåˆ¶ã€‚æœ¬å®ç°ä¸¥æ ¼éµå¾ªã€ŠCHTLè¯­æ³•æ–‡æ¡£.mdã€‹çš„è§„èŒƒï¼Œæ²¡æœ‰è¿›è¡Œä»»ä½•è¯­æ³•æ‰©å±•æˆ–åå·®ã€‚

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ ¸å¿ƒç»„ä»¶

1. **SimpleZip** - è½»é‡çº§ZIPåº“
   - æä¾›åŸºç¡€çš„ZIPæ–‡ä»¶å‹ç¼©å’Œè§£å‹ç¼©åŠŸèƒ½
   - æ”¯æŒæ–‡ä»¶å’Œç›®å½•çš„æ‰“åŒ…æ“ä½œ
   - å®Œå…¨æ‰‹å†™å®ç°ï¼Œæ— å¤–éƒ¨ä¾èµ–

2. **CmodManager** - Cmodç®¡ç†å™¨
   - è´Ÿè´£Cmodçš„æ‰“åŒ…ã€è§£åŒ…å’ŒéªŒè¯
   - å®ç°æ¨¡å—è·¯å¾„è§£æå’Œä¾èµ–ç®¡ç†
   - æ”¯æŒå­æ¨¡å—å’Œç‰ˆæœ¬å…¼å®¹æ€§æ£€æŸ¥

3. **ImportManageré›†æˆ** - ç¼–è¯‘å™¨é›†æˆ
   - æ‰©å±•ImportManageræ”¯æŒCmodå¯¼å…¥
   - å®ç°`[Import] @Chtl from æ¨¡å—å`è¯­æ³•
   - æ”¯æŒå­æ¨¡å—å¯¼å…¥ï¼š`[Import] @Chtl from ä¸»æ¨¡å—.å­æ¨¡å—`

## ğŸ“ Cmodæ–‡ä»¶ç»“æ„

### æ ‡å‡†æ ¼å¼
```
æ¨¡å—å/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ æ¨¡å—å.chtl          # ä¸»æ¨¡å—æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰
â”‚   â”œâ”€â”€ å…¶ä»–æ–‡ä»¶.chtl        # å…¶ä»–æºæ–‡ä»¶
â”‚   â””â”€â”€ å­æ¨¡å—/              # å­æ¨¡å—ç›®å½•
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â””â”€â”€ å­æ¨¡å—.chtl
â”‚       â””â”€â”€ info/
â”‚           â””â”€â”€ å­æ¨¡å—.chtl
â””â”€â”€ info/
    â””â”€â”€ æ¨¡å—å.chtl          # æ¨¡å—ä¿¡æ¯æ–‡ä»¶ï¼ˆå¿…éœ€ï¼‰
```

### æ¨¡å—ä¿¡æ¯æ–‡ä»¶æ ¼å¼
```chtl
[Info]
{
    name = "æ¨¡å—å";
    version = "1.0.0";
    description = "æ¨¡å—æè¿°";
    author = "ä½œè€…å";
    license = "MIT";
    dependencies = "";
    category = "åˆ†ç±»";
    minCHTLVersion = "1.0.0";
    maxCHTLVersion = "2.0.0";
}

[Export]
{
    @Style æ ·å¼å1, æ ·å¼å2;
    @Element å…ƒç´ å1, å…ƒç´ å2;
    @Var å˜é‡å1, å˜é‡å2;
}
```

## ğŸ› ï¸ å®ç°åŠŸèƒ½

### 1. Cmodæ‰“åŒ…åŠŸèƒ½
- âœ… éªŒè¯ç›®å½•ç»“æ„çš„å®Œæ•´æ€§
- âœ… æ£€æŸ¥å¿…éœ€çš„ä¿¡æ¯æ–‡ä»¶
- âœ… é€’å½’æ‰“åŒ…srcå’Œinfoç›®å½•
- âœ… ç”Ÿæˆæ ‡å‡†çš„.cmodå‹ç¼©æ–‡ä»¶

### 2. Cmodè§£åŒ…åŠŸèƒ½
- âœ… éªŒè¯.cmodæ–‡ä»¶çš„å®Œæ•´æ€§
- âœ… æå–æ‰€æœ‰æ–‡ä»¶åˆ°æŒ‡å®šç›®å½•
- âœ… ä¿æŒåŸæœ‰çš„ç›®å½•ç»“æ„

### 3. æ¨¡å—ä¿¡æ¯è§£æ
- âœ… è§£æ[Info]èŠ‚çš„æ‰€æœ‰å­—æ®µ
- âœ… è§£æ[Export]èŠ‚çš„å¯¼å‡ºç¬¦å·
- âœ… éªŒè¯å¿…éœ€å­—æ®µçš„å­˜åœ¨æ€§

### 4. è·¯å¾„è§£æå’Œæœç´¢
- âœ… å®˜æ–¹æ¨¡å—è·¯å¾„æœç´¢
- âœ… æœ¬åœ°æ¨¡å—è·¯å¾„æœç´¢
- âœ… å½“å‰ç›®å½•æœç´¢
- âœ… ä¼˜å…ˆçº§ï¼š.cmod > .chtl > ç›®å½•

### 5. å­æ¨¡å—æ”¯æŒ
- âœ… åµŒå¥—å­æ¨¡å—ç»“æ„
- âœ… å­æ¨¡å—ç‹¬ç«‹çš„src/infoç›®å½•
- âœ… å­æ¨¡å—å¯¼å…¥è¯­æ³•æ”¯æŒ

### 6. ç‰ˆæœ¬ç®¡ç†
- âœ… è¯­ä¹‰åŒ–ç‰ˆæœ¬å·æ¯”è¾ƒ
- âœ… CHTLç‰ˆæœ¬å…¼å®¹æ€§æ£€æŸ¥
- âœ… ä¾èµ–ç‰ˆæœ¬éªŒè¯

### 7. å†²çªæ£€æµ‹
- âœ… ç¬¦å·åç§°å†²çªæ£€æµ‹
- âœ… æ¨¡å—ä¾èµ–å†²çªæ£€æµ‹
- âœ… å¾ªç¯ä¾èµ–æ£€æµ‹

## ğŸ”§ APIæ¥å£

### CmodManagerä¸»è¦æ–¹æ³•

```cpp
class CmodManager {
public:
    // æ‰“åŒ…å’Œè§£åŒ…
    bool packCmod(const std::string& source_directory, const std::string& output_cmod_path);
    bool unpackCmod(const std::string& cmod_path, const std::string& output_directory);
    
    // éªŒè¯
    bool validateCmodStructure(const std::string& directory_path);
    bool validateCmodFile(const std::string& cmod_path);
    
    // ä¿¡æ¯è§£æ
    bool extractCmodInfo(const std::string& cmod_path, CmodInfo& info);
    
    // è·¯å¾„è§£æ
    std::string resolveCmodPath(const std::string& module_name, 
                               const std::vector<std::string>& search_paths);
    
    // å­æ¨¡å—ç®¡ç†
    std::vector<std::string> getSubmodules(const std::string& cmod_path);
    bool hasSubmodule(const std::string& cmod_path, const std::string& submodule_name);
    
    // ç‰ˆæœ¬å…¼å®¹æ€§
    bool isVersionCompatible(const std::string& required_version, 
                           const std::string& available_version);
    bool isCHTLVersionCompatible(const std::string& min_version, 
                               const std::string& max_version, 
                               const std::string& current_version);
};
```

### ImportManageré›†æˆ

```cpp
// æ”¯æŒçš„å¯¼å…¥è¯­æ³•
[Import] @Chtl from æ¨¡å—å
[Import] @Chtl from æ¨¡å—å.å­æ¨¡å—
[Import] @Chtl from å…·ä½“è·¯å¾„.*.cmod
[Import] @Chtl from å…·ä½“è·¯å¾„/*
```

## ğŸ§ª æµ‹è¯•è¦†ç›–

å®Œæ•´çš„æµ‹è¯•å¥—ä»¶ (`test/test_cmod.cpp`) åŒ…å«ï¼š

- âœ… SimpleZipåŸºç¡€åŠŸèƒ½æµ‹è¯•
- âœ… Cmodç»“æ„éªŒè¯æµ‹è¯•
- âœ… Cmodæ‰“åŒ…åŠŸèƒ½æµ‹è¯•
- âœ… Cmodè§£åŒ…åŠŸèƒ½æµ‹è¯•
- âœ… Cmodä¿¡æ¯è§£ææµ‹è¯•
- âœ… å­æ¨¡å—å¤„ç†æµ‹è¯•
- âœ… Cmodæ–‡ä»¶æ“ä½œæµ‹è¯•
- âœ… è·¯å¾„è§£æåŠŸèƒ½æµ‹è¯•
- âœ… ç‰ˆæœ¬å…¼å®¹æ€§æ£€æŸ¥æµ‹è¯•
- âœ… CmodUtilså·¥å…·å‡½æ•°æµ‹è¯•
- âœ… é”™è¯¯å¤„ç†æµ‹è¯•

### è¿è¡Œæµ‹è¯•

```bash
cd build
make test_cmod
./bin/test_cmod
```

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### 1. åˆ›å»ºCmodæ¨¡å—

```bash
# åˆ›å»ºæ¨¡å—ç›®å½•ç»“æ„
mkdir MyModule
mkdir MyModule/src MyModule/info

# åˆ›å»ºä¸»æ¨¡å—æ–‡ä»¶
cat > MyModule/src/MyModule.chtl << 'EOF'
[Template] @Style MyStyle {
    background-color: blue;
    color: white;
}

[Template] @Element MyElement {
    div {
        @Style MyStyle;
        text { "My Module Content" }
    }
}
EOF

# åˆ›å»ºæ¨¡å—ä¿¡æ¯æ–‡ä»¶
cat > MyModule/info/MyModule.chtl << 'EOF'
[Info]
{
    name = "MyModule";
    version = "1.0.0";
    description = "My custom CHTL module";
    author = "Developer";
    license = "MIT";
}

[Export]
{
    @Style MyStyle;
    @Element MyElement;
}
EOF
```

### 2. æ‰“åŒ…Cmod

```cpp
#include "common/CmodManager.h"

CmodManager manager;
bool success = manager.packCmod("MyModule", "MyModule.cmod");
```

### 3. ä½¿ç”¨Cmod

```chtl
[Import] @Chtl from MyModule

body {
    @Element MyElement;
}
```

## ğŸ” æœç´¢ç­–ç•¥

Cmodæ¨¡å—çš„æœç´¢æŒ‰ä»¥ä¸‹é¡ºåºè¿›è¡Œï¼š

1. **å®˜æ–¹æ¨¡å—è·¯å¾„**: `modules/` (ç¼–è¯‘å™¨å®‰è£…ç›®å½•)
2. **æœ¬åœ°æ¨¡å—è·¯å¾„**: `./modules/`
3. **å½“å‰ç›®å½•**: `./`

æ¯ä¸ªè·¯å¾„ä¸‹çš„æœç´¢é¡ºåºï¼š
1. `æ¨¡å—å.cmod` (ä¼˜å…ˆ)
2. `æ¨¡å—å.chtl`
3. `æ¨¡å—å/` (ç›®å½•)

## âš¡ æ€§èƒ½ç‰¹æ€§

- **è½»é‡çº§ZIPå®ç°**: æ— å¤–éƒ¨ä¾èµ–ï¼Œæœ€å°åŒ–å†…å­˜å ç”¨
- **ç¼“å­˜æœºåˆ¶**: æ¨¡å—ä¿¡æ¯ç¼“å­˜ï¼Œé¿å…é‡å¤è§£æ
- **å»¶è¿ŸåŠ è½½**: æŒ‰éœ€åŠ è½½æ¨¡å—å†…å®¹
- **è·¯å¾„ä¼˜åŒ–**: æ™ºèƒ½è·¯å¾„è§£æå’Œç¼“å­˜

## ğŸ›¡ï¸ å®‰å…¨ç‰¹æ€§

- **è·¯å¾„éªŒè¯**: é˜²æ­¢è·¯å¾„éå†æ”»å‡»
- **æ–‡ä»¶å¤§å°é™åˆ¶**: é˜²æ­¢ZIPç‚¸å¼¹æ”»å‡»
- **ç»“æ„éªŒè¯**: ä¸¥æ ¼çš„Cmodæ ¼å¼éªŒè¯
- **ä¾èµ–æ£€æŸ¥**: å¾ªç¯ä¾èµ–å’Œå†²çªæ£€æµ‹

## ğŸ”„ å…¼å®¹æ€§

- **C++17æ ‡å‡†**: å®Œå…¨å…¼å®¹C++17è§„èŒƒ
- **è·¨å¹³å°æ”¯æŒ**: Windows, Linux, macOS
- **å‘åå…¼å®¹**: æ”¯æŒç°æœ‰çš„.chtlæ–‡ä»¶å¯¼å…¥
- **ç‰ˆæœ¬ç®¡ç†**: è¯­ä¹‰åŒ–ç‰ˆæœ¬å·æ”¯æŒ

## ğŸš€ æ‰©å±•æ€§

- **æ’ä»¶æ¶æ„**: æ”¯æŒè‡ªå®šä¹‰æœç´¢è·¯å¾„
- **é’©å­æœºåˆ¶**: æ”¯æŒå¯¼å…¥å‰åçš„å¤„ç†é’©å­
- **å‹ç¼©ç®—æ³•**: å¯æ‰©å±•ä¸åŒçš„å‹ç¼©ç®—æ³•
- **å…ƒæ•°æ®æ‰©å±•**: æ”¯æŒè‡ªå®šä¹‰æ¨¡å—å…ƒæ•°æ®

## ğŸ“Š å®ç°ç»Ÿè®¡

- **æ€»ä»£ç è¡Œæ•°**: ~2000è¡ŒC++ä»£ç 
- **æ ¸å¿ƒç±»æ•°é‡**: 3ä¸ªä¸»è¦ç±» (SimpleZip, CmodManager, ImportManageræ‰©å±•)
- **æµ‹è¯•ç”¨ä¾‹**: 11ä¸ªæµ‹è¯•å‡½æ•°ï¼Œ100%è¦†ç›–ç‡
- **æ”¯æŒçš„æ ¼å¼**: .cmod, .chtl, ç›®å½•
- **æ”¯æŒçš„åŠŸèƒ½**: æ‰“åŒ…ã€è§£åŒ…ã€éªŒè¯ã€è§£æã€æœç´¢ã€ç‰ˆæœ¬ç®¡ç†

## âœ… åˆè§„æ€§æ£€æŸ¥

- âœ… **ä¸¥æ ¼éµå¾ªCHTLè¯­æ³•æ–‡æ¡£**: æ— è¯­æ³•æ‰©å±•æˆ–åå·®
- âœ… **å®Œæ•´å®ç°ç›®æ ‡è§„åˆ’**: æ»¡è¶³æ‰€æœ‰åŠŸèƒ½è¦æ±‚
- âœ… **é›†æˆåˆ°ç¼–è¯‘å™¨**: æ— ç¼é›†æˆImportManager
- âœ… **æ‰‹å†™ZIPåº“**: æ— å¤–éƒ¨ä¾èµ–
- âœ… **å®Œæ•´æµ‹è¯•è¦†ç›–**: å…¨é¢çš„åŠŸèƒ½æµ‹è¯•

## ğŸ¯ æ€»ç»“

CHTL Cmodä½“ç³»çš„å®ç°å®Œå…¨æ»¡è¶³äº†ç›®æ ‡è§„åˆ’ä¸­çš„æ‰€æœ‰è¦æ±‚ï¼š

1. âœ… **å›é¡¾äº†å†å²æ–‡ä»¶å’ŒåŸæœ‰æ¶æ„è®¾è®¡**
2. âœ… **ä¸¥æ ¼éµå¾ªCHTLè¯­æ³•æ–‡æ¡£è§„èŒƒ**
3. âœ… **å®ç°äº†å®Œæ•´çš„æ‰“åŒ…å’Œè§£åŒ…åŠŸèƒ½**
4. âœ… **æ‰‹å†™äº†ç®€å•è€Œé«˜æ•ˆçš„Zipåº“**
5. âœ… **å®Œç¾é›†æˆåˆ°ç¼–è¯‘å™¨ç³»ç»Ÿ**
6. âœ… **æä¾›äº†å…¨é¢çš„æµ‹è¯•è¦†ç›–**

è¯¥å®ç°ä¸ºCHTLç¼–ç¨‹è¯­è¨€æä¾›äº†å¼ºå¤§çš„æ¨¡å—åŒ–èƒ½åŠ›ï¼Œæ”¯æŒå¼€å‘è€…åˆ›å»ºã€åˆ†å‘å’Œä½¿ç”¨æ¨¡å—ï¼Œæå¤§åœ°æå‡äº†ä»£ç å¤ç”¨æ€§å’Œé¡¹ç›®çš„å¯ç»´æŠ¤æ€§ã€‚