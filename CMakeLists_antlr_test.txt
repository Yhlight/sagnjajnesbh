cmake_minimum_required(VERSION 3.16)
project(CHTLANTLRTest VERSION 1.0.0 LANGUAGES CXX)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -Wall -Wextra -Wno-unused-parameter -Wno-unused-variable")

include_directories(src)
include_directories(external/antlr4-install/include/antlr4-runtime)

# 共享组件（最小化）
add_library(chtl_shared_min STATIC
    src/Shared/Utils/FileUtils.cpp
)

# CSS编译器（使用ANTLR）
add_library(chtl_css_compiler STATIC
    src/CSSCompiler/Parser/css3Lexer.cpp
    src/CSSCompiler/Parser/css3Parser.cpp
    src/CSSCompiler/Parser/css3ParserBaseListener.cpp
    src/CSSCompiler/Parser/css3ParserListener.cpp
    src/CSSCompiler/Core/CSSCompilerCore.cpp
)
target_link_libraries(chtl_css_compiler chtl_shared_min ${CMAKE_CURRENT_SOURCE_DIR}/external/antlr4-install/lib/libantlr4-runtime.a)

# JavaScript编译器（使用ANTLR）
add_library(chtl_js_compiler_antlr STATIC
    src/JavaScriptCompiler/Parser/JavaScriptLexer_cpp.cpp
    src/JavaScriptCompiler/Parser/JavaScriptParser_cpp.cpp
    src/JavaScriptCompiler/Parser/JavaScriptParser_cppBaseListener.cpp
    src/JavaScriptCompiler/Parser/JavaScriptParser_cppListener.cpp
    src/JavaScriptCompiler/Parser/JavaScriptLexerBase.cpp
    src/JavaScriptCompiler/Parser/JavaScriptParserBase.cpp
    src/JavaScriptCompiler/Core/JavaScriptCompilerCore.cpp
)
target_link_libraries(chtl_js_compiler_antlr chtl_shared_min ${CMAKE_CURRENT_SOURCE_DIR}/external/antlr4-install/lib/libantlr4-runtime.a)

# ANTLR编译器测试
add_executable(test_antlr_compilers test/test_antlr_compilers.cpp)
target_link_libraries(test_antlr_compilers chtl_css_compiler chtl_js_compiler_antlr)

# 设置输出目录
set_target_properties(
    chtl_shared_min chtl_css_compiler chtl_js_compiler_antlr
    PROPERTIES ARCHIVE_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/lib
)

set_target_properties(
    test_antlr_compilers
    PROPERTIES RUNTIME_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/bin
)