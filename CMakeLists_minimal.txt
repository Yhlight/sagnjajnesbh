cmake_minimum_required(VERSION 3.16)
project(CHTLCompiler VERSION 1.0.0 LANGUAGES CXX)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -Wall -Wextra -Wno-unused-parameter -Wno-unused-variable")

include_directories(src)

# 核心共享组件（最小化，仅包含确实存在且能编译的文件）
add_library(chtl_core STATIC
    src/Shared/Utils/FileUtils.cpp
    src/Shared/Core/NamespaceAlgorithms.cpp
    src/Shared/Core/ErrorHandler.cpp
    src/Shared/Common/common/ModulePathManager.cpp
    src/CHTLCompiler/Import/ImportManager.cpp
    src/UnifiedCore/Configuration/ConfigurationManager.cpp
    src/UnifiedCore/Configuration/ConfigurationImporter.cpp
    src/UnifiedCore/Export/ExportGenerator.cpp
    src/UnifiedCore/Scanner/CHTLUnifiedScanner.cpp
    src/UnifiedCore/Dispatcher/CompilerDispatcher.cpp
    src/CSSCompiler/Core/CSSCompilerCore.cpp
    src/JavaScriptCompiler/Core/JavaScriptCompilerCore.cpp
    src/CHTLJSCompiler/Animation/AnimateSystemProcessor.cpp
)

# 基本测试可执行文件
add_executable(test_basic_compile test/test_basic_compile.cpp)
target_link_libraries(test_basic_compile chtl_core)

# 测试统一扫描器
add_executable(test_unified_scanner test/test_unified_scanner.cpp)
target_link_libraries(test_unified_scanner chtl_core)

# 设置输出目录
set_target_properties(chtl_core PROPERTIES ARCHIVE_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/lib)
set_target_properties(test_basic_compile test_unified_scanner PROPERTIES RUNTIME_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/bin)