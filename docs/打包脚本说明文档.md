# CHTLæ‰“åŒ…è„šæœ¬è¯´æ˜æ–‡æ¡£

## ğŸ“‹ æ¦‚è¿°

CHTLé¡¹ç›®çš„æ‰“åŒ…è„šæœ¬ç³»ç»Ÿä¸“é—¨ç”¨äºå°†CHTLæ¨¡å—æ‰“åŒ…æˆæ ‡å‡†çš„åˆ†å‘æ ¼å¼ã€‚è¯¥ç³»ç»Ÿæ”¯æŒCMODï¼ˆCHTLç»„ä»¶æ¨¡å—ï¼‰å’ŒCJMODï¼ˆCHTL JSæ‰©å±•æ¨¡å—ï¼‰ä¸¤ç§æ¨¡å—ç±»å‹ï¼Œä¸¥æ ¼æŒ‰ç…§CHTLè¯­æ³•æ–‡æ¡£çš„æ¨¡å—è§„èŒƒè¿›è¡Œæ‰“åŒ…å’ŒéªŒè¯ã€‚

## ğŸ“¦ æ¨¡å—æ‰“åŒ…æ¦‚å¿µ

### æ¨¡å—ç±»å‹

**CMODæ¨¡å—ï¼ˆCHTL Moduleï¼‰ï¼š**
- çº¯CHTLè¯­æ³•ç¼–å†™çš„ç»„ä»¶æ¨¡å—
- åŒ…å«æ ·å¼ã€å…ƒç´ ã€æ¨¡æ¿å’Œé…ç½®
- æ–‡ä»¶æ ¼å¼ï¼š`.cmod`ï¼ˆå®é™…ä¸ºZIPæ ¼å¼ï¼‰
- ç¤ºä¾‹ï¼šç‚æœµè‰æ¨¡å—ã€ç”±æ¯”æ»¨ç»“è¡£æ¨¡å—

**CJMODæ¨¡å—ï¼ˆCHTL JS Moduleï¼‰ï¼š**
- C++ç¼–å†™çš„CHTL JSæ‰©å±•æ¨¡å—
- æä¾›åŸç”Ÿæ€§èƒ½çš„åŠŸèƒ½æ‰©å±•
- æ–‡ä»¶æ ¼å¼ï¼š`.cjmod`ï¼ˆå®é™…ä¸ºZIPæ ¼å¼ï¼‰
- ç¤ºä¾‹ï¼šprintMyloveã€iNeverAway

**æ··åˆæ¨¡å—ï¼š**
- åŒæ—¶åŒ…å«CMODå’ŒCJMODçš„å¤åˆæ¨¡å—
- ç›®å½•ç»“æ„ï¼š`ModuleName/CMOD/` å’Œ `ModuleName/CJMOD/`
- åˆ†åˆ«æ‰“åŒ…æˆç‹¬ç«‹çš„.cmodå’Œ.cjmodæ–‡ä»¶
- ç¤ºä¾‹ï¼šç‚æœµè‰æ¨¡å—ï¼ˆæ··åˆæ¶æ„ï¼‰

### æ¨¡å—ç»“æ„è§„èŒƒ

æ ¹æ®CHTLè¯­æ³•æ–‡æ¡£ï¼Œæ ‡å‡†æ¨¡å—ç»“æ„å¦‚ä¸‹ï¼š

**CMODæ¨¡å—ç»“æ„ï¼š**
```
ComponentName/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ ComponentName.chtl    # ä¸»æºæ–‡ä»¶ âœ“ å¿…éœ€
â”‚   â””â”€â”€ Additional.chtl        # å…¶ä»–æºæ–‡ä»¶ â—‹ å¯é€‰
â””â”€â”€ info/
    â””â”€â”€ ComponentName.chtl     # æ¨¡å—ä¿¡æ¯æ–‡ä»¶ âœ“ å¿…éœ€
```

**CJMODæ¨¡å—ç»“æ„ï¼š**
```
ExtensionName/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ ExtensionName.cpp      # C++æºæ–‡ä»¶ âœ“ å»ºè®®
â”‚   â”œâ”€â”€ ExtensionName.h        # C++å¤´æ–‡ä»¶ âœ“ å»ºè®®
â”‚   â””â”€â”€ *.cpp, *.h             # å…¶ä»–æºæ–‡ä»¶ â—‹ å¯é€‰
â””â”€â”€ info/
    â””â”€â”€ ExtensionName.chtl     # æ¨¡å—ä¿¡æ¯æ–‡ä»¶ âœ“ å¿…éœ€
```

## ğŸ”§ CMODæ‰“åŒ…è„šæœ¬è¯¦è§£

### è„šæœ¬æ–‡ä»¶

**ä½ç½®ï¼š**
- Windows: `scripts/windows/package_cmod.bat`
- Linux: `scripts/linux/package_cmod.sh`
- macOS: `scripts/macos/package_cmod.sh`

### ä½¿ç”¨æ–¹æ³•

**åŸºç¡€è¯­æ³•ï¼š**
```bash
# Windows
scripts\windows\package_cmod.bat <æ¨¡å—è·¯å¾„>

# Linux/macOS
scripts/linux/package_cmod.sh <æ¨¡å—è·¯å¾„>
```

**å®é™…ç¤ºä¾‹ï¼š**
```bash
# æ‰“åŒ…ç‚æœµè‰æ ¸å¿ƒæ¨¡å—
scripts/windows/package_cmod.bat Chtholly\CMOD\Core

# æ‰“åŒ…ç”±æ¯”æ»¨ç»“è¡£éŸ³ä¹æ’­æ”¾å™¨
scripts/linux/package_cmod.sh Yuigahama/CMOD/MusicPlayer

# æ‰“åŒ…æ‰‹é£ç´ç»„ä»¶
scripts/macos/package_cmod.sh Chtholly/CMOD/Accordion
```

### è„šæœ¬æ‰§è¡Œæµç¨‹

**ç¬¬ä¸€æ­¥ï¼šè·¯å¾„éªŒè¯**
```bash
# æ£€æŸ¥è¾“å…¥å‚æ•°
if [ $# -eq 0 ]; then
    echo "é”™è¯¯ï¼šæœªæä¾›æ¨¡å—è·¯å¾„"
    exit 1
fi

# éªŒè¯æ¨¡å—ç›®å½•å­˜åœ¨
if [ ! -d "${SOURCE_DIR}/${MODULE_PATH}" ]; then
    echo "é”™è¯¯ï¼šæ¨¡å—è·¯å¾„ä¸å­˜åœ¨ ${MODULE_PATH}"
    exit 1
fi
```

**ç¬¬äºŒæ­¥ï¼šæ¨¡å—åç§°æå–**
```bash
# ä»è·¯å¾„ä¸­æå–æ¨¡å—åç§°
MODULE_NAME="$(basename "${MODULE_PATH}")"
echo "æ­£åœ¨æ‰“åŒ…CMODæ¨¡å—: ${MODULE_NAME}"
```

**ç¬¬ä¸‰æ­¥ï¼šä¸´æ—¶ç›®å½•åˆ›å»º**
```bash
# åˆ›å»ºä¸´æ—¶æ‰“åŒ…ç›®å½•
TEMP_DIR="/tmp/chtl_cmod_package_$$"
mkdir -p "${TEMP_DIR}/${MODULE_NAME}"
```

**ç¬¬å››æ­¥ï¼šæ–‡ä»¶ç»“æ„å¤åˆ¶**
```bash
# å¤åˆ¶srcç›®å½•
cp -r "${SOURCE_DIR}/${MODULE_PATH}/src" "${TEMP_DIR}/${MODULE_NAME}/"

# å¤åˆ¶infoç›®å½•
cp -r "${SOURCE_DIR}/${MODULE_PATH}/info" "${TEMP_DIR}/${MODULE_NAME}/"
```

**ç¬¬äº”æ­¥ï¼šç»“æ„å®Œæ•´æ€§éªŒè¯**
```bash
# æ£€æŸ¥ä¸»æºæ–‡ä»¶
if [ ! -f "${TEMP_DIR}/${MODULE_NAME}/src/${MODULE_NAME}.chtl" ]; then
    echo "è­¦å‘Šï¼šä¸»æºæ–‡ä»¶ ${MODULE_NAME}.chtl æœªåœ¨srcç›®å½•ä¸­æ‰¾åˆ°"
fi

# æ£€æŸ¥ä¿¡æ¯æ–‡ä»¶
if [ ! -f "${TEMP_DIR}/${MODULE_NAME}/info/${MODULE_NAME}.chtl" ]; then
    echo "è­¦å‘Šï¼šä¿¡æ¯æ–‡ä»¶ ${MODULE_NAME}.chtl æœªåœ¨infoç›®å½•ä¸­æ‰¾åˆ°"
fi
```

**ç¬¬å…­æ­¥ï¼šæ‰“åŒ…å‹ç¼©**
```bash
# åˆ›å»º.cmodåŒ…
PACKAGE_FILE="${DIST_DIR}/${MODULE_NAME}.cmod"
cd "${TEMP_DIR}"
zip -r "${PACKAGE_FILE}" "${MODULE_NAME}" > /dev/null
```

**ç¬¬ä¸ƒæ­¥ï¼šæ¸…ç†å·¥ä½œ**
```bash
# åˆ é™¤ä¸´æ—¶ç›®å½•
rm -rf "${TEMP_DIR}"

echo "CMODæ‰“åŒ…å®Œæˆ: ${PACKAGE_FILE}"
```

### ä¿¡æ¯æ–‡ä»¶æ ¼å¼

æ ¹æ®CHTLè¯­æ³•æ–‡æ¡£ï¼Œä¿¡æ¯æ–‡ä»¶åº”åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š

```chtl
[Info] {
    name = "ModuleName";
    version = "1.0.0";
    description = "æ¨¡å—æè¿°";
    author = "ä½œè€…åç§°";
    license = "MIT";
    dependencies = "RequiredModule";
    category = "ui-component";
    minCHTLVersion = "1.0.0";
    maxCHTLVersion = "2.0.0";
    keywords = "component,ui,library";
    features = "responsive,accessible,customizable";
}

[Export] {
    [Template] @Style ModuleStyle;
    [Template] @Element ModuleElement;
    [Template] @Var ModuleVariable;
    [Custom] @Style CustomStyle;
    [Custom] @Element CustomElement;
    [Origin] @Html HtmlBlock;
    [Origin] @Style StyleBlock;
    [Origin] @JavaScript ScriptBlock;
    [Configuration] @Config ModuleConfig;
}
```

## âš¡ CJMODæ‰“åŒ…è„šæœ¬è¯¦è§£

### è„šæœ¬æ–‡ä»¶

**ä½ç½®ï¼š**
- Windows: `scripts/windows/package_cjmod.bat`
- Linux: `scripts/linux/package_cjmod.sh`
- macOS: `scripts/macos/package_cjmod.sh`

### ä½¿ç”¨æ–¹æ³•

**åŸºç¡€è¯­æ³•ï¼š**
```bash
# Windows
scripts\windows\package_cjmod.bat <æ¨¡å—è·¯å¾„>

# Linux/macOS
scripts/linux/package_cjmod.sh <æ¨¡å—è·¯å¾„>
```

**å®é™…ç¤ºä¾‹ï¼š**
```bash
# æ‰“åŒ…printMyloveæ‰©å±•
scripts/windows/package_cjmod.bat Chtholly\CJMOD\printMylove

# æ‰“åŒ…iNeverAwayæ‰©å±•
scripts/linux/package_cjmod.sh Chtholly/CJMOD/iNeverAway
```

### è„šæœ¬æ‰§è¡Œæµç¨‹

**ç¬¬ä¸€æ­¥ï¼šè·¯å¾„å’Œå‚æ•°éªŒè¯**
```bash
# ä¸CMODè„šæœ¬ç›¸åŒçš„éªŒè¯æµç¨‹
if [ $# -eq 0 ]; then
    echo "ç”¨æ³•: $0 <æ¨¡å—è·¯å¾„>"
    echo "ç¤ºä¾‹: $0 Chtholly/CJMOD/printMylove"
    exit 1
fi
```

**ç¬¬äºŒæ­¥ï¼šC++æ–‡ä»¶éªŒè¯**
```bash
# æ£€æŸ¥C++æºæ–‡ä»¶å­˜åœ¨æ€§
CPP_FOUND=0
if [ -n "$(find "${TEMP_DIR}/${MODULE_NAME}/src" -name "*.cpp" -o -name "*.h" 2>/dev/null)" ]; then
    CPP_FOUND=1
fi

if [ $CPP_FOUND -eq 0 ]; then
    echo "è­¦å‘Šï¼šsrcç›®å½•ä¸­æœªæ‰¾åˆ°C++æºæ–‡ä»¶ï¼ˆ.cpp/.hï¼‰"
fi
```

**ç¬¬ä¸‰æ­¥ï¼šå…¶ä»–æµç¨‹**
- ä¸CMODè„šæœ¬çš„å…¶ä»–æ­¥éª¤åŸºæœ¬ç›¸åŒ
- æœ€ç»ˆç”Ÿæˆ`.cjmod`æ ¼å¼çš„åŒ…æ–‡ä»¶

### CJMODä¿¡æ¯æ–‡ä»¶

CJMODçš„ä¿¡æ¯æ–‡ä»¶æ ¼å¼ä¸CMODç±»ä¼¼ï¼Œä½†éœ€è¦åŒ…å«C++ç›¸å…³ä¿¡æ¯ï¼š

```chtl
[Info] {
    name = "ExtensionName";
    version = "1.0.0";
    description = "C++æ‰©å±•æ¨¡å—æè¿°";
    author = "ä½œè€…åç§°";
    license = "MIT";
    category = "native-extension";
    
    // C++ç‰¹å®šä¿¡æ¯
    cppStandard = "17";
    compilerRequirements = "GCC 9+, Clang 10+, MSVC 2019+";
    dependencies = "CHTL Core";
    
    // å¹³å°å…¼å®¹æ€§
    platforms = "Windows,Linux,macOS";
    architecture = "x64,ARM64";
}

[Export] {
    // CJMODå¯¼å‡ºçš„å‡½æ•°å’Œç±»
    [Function] printMylove;
    [Function] iNeverAway;
    [Class] CHTLJSExtension;
}
```

## ğŸ¯ ç»Ÿä¸€æ‰“åŒ…è„šæœ¬

### æ™ºèƒ½æ¨¡å—è¯†åˆ«

ç»Ÿä¸€æ‰“åŒ…è„šæœ¬èƒ½å¤Ÿè‡ªåŠ¨è¯†åˆ«æ¨¡å—ç±»å‹ï¼š

**è·¯å¾„æ¨¡å¼è¯†åˆ«ï¼š**
```bash
# æ£€æŸ¥è·¯å¾„ä¸­çš„å…³é”®å­—
if echo "${MODULE_PATH}" | grep -i "CMOD" > /dev/null; then
    MODULE_TYPE="CMOD"
elif echo "${MODULE_PATH}" | grep -i "CJMOD" > /dev/null; then
    MODULE_TYPE="CJMOD"
fi
```

**å†…å®¹è‡ªåŠ¨æ£€æµ‹ï¼š**
```bash
# å¦‚æœè·¯å¾„æ¨¡å¼ä¸æ˜ç¡®ï¼Œæ£€æŸ¥æ–‡ä»¶å†…å®¹
if [ -z "${MODULE_TYPE}" ]; then
    if find "${SOURCE_DIR}/${MODULE_PATH}/src" -name "*.cpp" -o -name "*.h" 2>/dev/null | grep -q .; then
        MODULE_TYPE="CJMOD"
    else
        MODULE_TYPE="CMOD"
    fi
fi
```

**è°ƒç”¨ç›¸åº”è„šæœ¬ï¼š**
```bash
case "${MODULE_TYPE}" in
    "CMOD")
        echo "è°ƒç”¨CMODæ‰“åŒ…è„šæœ¬..."
        "${SCRIPT_DIR}/package_cmod.sh" "${MODULE_PATH}"
        ;;
    "CJMOD")
        echo "è°ƒç”¨CJMODæ‰“åŒ…è„šæœ¬..."
        "${SCRIPT_DIR}/package_cjmod.sh" "${MODULE_PATH}"
        ;;
    *)
        echo "é”™è¯¯ï¼šæ— æ³•è¯†åˆ«æ¨¡å—ç±»å‹"
        exit 1
        ;;
esac
```

## ğŸ“ æ¨¡å—æœç´¢è·¯å¾„è§„èŒƒ

æ ¹æ®CHTLè¯­æ³•æ–‡æ¡£å’Œæœ€æ–°çš„æ¨¡å—æœç´¢è·¯å¾„ä¿®æ­£ï¼Œæ‰“åŒ…è„šæœ¬æ”¯æŒä»¥ä¸‹æ¨¡å—ç»“æ„ï¼š

### æ— åºç»“æ„

æ¨¡å—æ–‡ä»¶ç›´æ¥æ”¾ç½®åœ¨moduleæ–‡ä»¶å¤¹æ ¹ç›®å½•ï¼š

```
module/
â”œâ”€â”€ Component1.cmod
â”œâ”€â”€ Component2.chtl
â”œâ”€â”€ Extension1.cjmod
â”œâ”€â”€ Extension2.cpp
â””â”€â”€ Extension2.h
```

### æœ‰åºç»“æ„

æŒ‰æ¨¡å—ç±»å‹åˆ†ç±»çš„ç›®å½•ç»“æ„ï¼š

```
module/
â”œâ”€â”€ CMOD/           # æˆ– Cmod/ æˆ– cmod/
â”‚   â”œâ”€â”€ Component1.cmod
â”‚   â””â”€â”€ Component2.chtl
â”œâ”€â”€ CJMOD/          # æˆ– CJmod/ æˆ– cjmod/
â”‚   â”œâ”€â”€ Extension1.cjmod
â”‚   â””â”€â”€ Extension2.cpp
â””â”€â”€ chtl/           # CHTLæºæ–‡ä»¶
    â””â”€â”€ Template.chtl
```

### æ··åˆç»“æ„æ”¯æŒ

**æ ‡å‡†æ··åˆæ¨¡å—ï¼š**
```
Chtholly/
â”œâ”€â”€ CMOD/
â”‚   â”œâ”€â”€ Core/
â”‚   â”œâ”€â”€ Accordion/
â”‚   â””â”€â”€ ProgressBar/
â””â”€â”€ CJMOD/
    â”œâ”€â”€ printMylove/
    â””â”€â”€ iNeverAway/
```

**æ‰å¹³æ··åˆæ¨¡å—ï¼š**
```
ModuleName/
â”œâ”€â”€ ComponentA.cmod
â”œâ”€â”€ ComponentB.chtl
â”œâ”€â”€ ExtensionA.cjmod
â””â”€â”€ ExtensionB.cpp
```

## ğŸ” æ‰“åŒ…éªŒè¯å’Œè´¨é‡æ§åˆ¶

### æ–‡ä»¶å®Œæ•´æ€§æ£€æŸ¥

**CMODæ¨¡å—éªŒè¯ï¼š**
```bash
# å¿…éœ€æ–‡ä»¶æ£€æŸ¥
check_cmod_structure() {
    local module_dir="$1"
    local module_name="$2"
    
    # æ£€æŸ¥srcç›®å½•
    if [ ! -d "${module_dir}/src" ]; then
        echo "é”™è¯¯ï¼šç¼ºå°‘srcç›®å½•"
        return 1
    fi
    
    # æ£€æŸ¥infoç›®å½•
    if [ ! -d "${module_dir}/info" ]; then
        echo "é”™è¯¯ï¼šç¼ºå°‘infoç›®å½•"
        return 1
    fi
    
    # æ£€æŸ¥ä¸»æºæ–‡ä»¶
    if [ ! -f "${module_dir}/src/${module_name}.chtl" ]; then
        echo "è­¦å‘Šï¼šå»ºè®®åŒ…å«ä¸»æºæ–‡ä»¶ ${module_name}.chtl"
    fi
    
    # æ£€æŸ¥ä¿¡æ¯æ–‡ä»¶
    if [ ! -f "${module_dir}/info/${module_name}.chtl" ]; then
        echo "é”™è¯¯ï¼šç¼ºå°‘ä¿¡æ¯æ–‡ä»¶ ${module_name}.chtl"
        return 1
    fi
    
    return 0
}
```

**CJMODæ¨¡å—éªŒè¯ï¼š**
```bash
# C++æ–‡ä»¶æ£€æŸ¥
check_cjmod_structure() {
    local module_dir="$1"
    local module_name="$2"
    
    # åŸºç¡€ç»“æ„æ£€æŸ¥ï¼ˆä¸CMODç›¸åŒï¼‰
    check_cmod_structure "$module_dir" "$module_name"
    local base_result=$?
    
    # C++æ–‡ä»¶æ£€æŸ¥
    local cpp_files=$(find "${module_dir}/src" -name "*.cpp" -o -name "*.h" 2>/dev/null | wc -l)
    if [ "$cpp_files" -eq 0 ]; then
        echo "è­¦å‘Šï¼šæœªæ‰¾åˆ°C++æºæ–‡ä»¶ï¼Œç¡®è®¤è¿™æ˜¯CJMODæ¨¡å—å—ï¼Ÿ"
    fi
    
    return $base_result
}
```

### è¯­æ³•æ–‡æ¡£åˆè§„æ€§éªŒè¯

**ä¿¡æ¯æ–‡ä»¶è§£æï¼š**
```bash
# éªŒè¯ä¿¡æ¯æ–‡ä»¶æ ¼å¼
validate_info_file() {
    local info_file="$1"
    
    # æ£€æŸ¥[Info]å—å­˜åœ¨
    if ! grep -q "^\[Info\]" "$info_file"; then
        echo "é”™è¯¯ï¼šä¿¡æ¯æ–‡ä»¶ç¼ºå°‘[Info]å—"
        return 1
    fi
    
    # æ£€æŸ¥å¿…éœ€å­—æ®µ
    local required_fields=("name" "version" "description")
    for field in "${required_fields[@]}"; do
        if ! grep -q "^[[:space:]]*${field}[[:space:]]*=" "$info_file"; then
            echo "è­¦å‘Šï¼šå»ºè®®åŒ…å«${field}å­—æ®µ"
        fi
    done
    
    # æ£€æŸ¥[Export]å—ï¼ˆå¯é€‰ä½†æ¨èï¼‰
    if grep -q "^\[Export\]" "$info_file"; then
        echo "ä¿¡æ¯ï¼šåŒ…å«Exportå—ï¼Œç”¨äºæ€§èƒ½ä¼˜åŒ–å’Œè®¿é—®æ§åˆ¶"
    fi
    
    return 0
}
```

### åŒ…å®Œæ•´æ€§éªŒè¯

**ç”Ÿæˆçš„åŒ…æ–‡ä»¶éªŒè¯ï¼š**
```bash
# éªŒè¯ç”Ÿæˆçš„åŒ…æ–‡ä»¶
verify_package() {
    local package_file="$1"
    local module_name="$2"
    
    # æ£€æŸ¥æ–‡ä»¶å­˜åœ¨
    if [ ! -f "$package_file" ]; then
        echo "é”™è¯¯ï¼šåŒ…æ–‡ä»¶ç”Ÿæˆå¤±è´¥"
        return 1
    fi
    
    # æ£€æŸ¥æ–‡ä»¶å¤§å°
    local file_size=$(stat -f%z "$package_file" 2>/dev/null || stat -c%s "$package_file" 2>/dev/null)
    if [ "$file_size" -lt 1024 ]; then
        echo "è­¦å‘Šï¼šåŒ…æ–‡ä»¶è¿‡å°ï¼Œå¯èƒ½å­˜åœ¨é—®é¢˜"
    fi
    
    # æ£€æŸ¥ZIPå®Œæ•´æ€§
    if command -v unzip >/dev/null 2>&1; then
        if unzip -t "$package_file" >/dev/null 2>&1; then
            echo "åŒ…æ–‡ä»¶å®Œæ•´æ€§éªŒè¯é€šè¿‡"
        else
            echo "é”™è¯¯ï¼šåŒ…æ–‡ä»¶æŸå"
            return 1
        fi
    fi
    
    return 0
}
```

## ğŸ“Š æ‰“åŒ…æ€§èƒ½å’Œä¼˜åŒ–

### å‹ç¼©é€‰é¡¹ä¼˜åŒ–

**å‹ç¼©çº§åˆ«é…ç½®ï¼š**
```bash
# æ ¹æ®æ¨¡å—å¤§å°é€‰æ‹©å‹ç¼©çº§åˆ«
optimize_compression() {
    local source_dir="$1"
    local total_size=$(du -s "$source_dir" | cut -f1)
    
    if [ "$total_size" -lt 1024 ]; then
        # å°æ¨¡å—ï¼šå¿«é€Ÿå‹ç¼©
        COMPRESSION_LEVEL="-1"
    elif [ "$total_size" -lt 10240 ]; then
        # ä¸­ç­‰æ¨¡å—ï¼šå¹³è¡¡å‹ç¼©
        COMPRESSION_LEVEL="-6"
    else
        # å¤§æ¨¡å—ï¼šæœ€ä¼˜å‹ç¼©
        COMPRESSION_LEVEL="-9"
    fi
    
    zip $COMPRESSION_LEVEL -r "$package_file" "$module_name"
}
```

### å¹¶è¡Œæ‰“åŒ…

**æ‰¹é‡æ‰“åŒ…ä¼˜åŒ–ï¼š**
```bash
# å¹¶è¡Œæ‰“åŒ…å¤šä¸ªæ¨¡å—
batch_package() {
    local modules=("$@")
    local max_jobs=4
    local job_count=0
    
    for module in "${modules[@]}"; do
        if [ $job_count -ge $max_jobs ]; then
            wait  # ç­‰å¾…ä¸€äº›ä»»åŠ¡å®Œæˆ
            job_count=0
        fi
        
        echo "å¼€å§‹æ‰“åŒ…: $module"
        package_module "$module" &
        ((job_count++))
    done
    
    wait  # ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ
}
```

### ç¼“å­˜æœºåˆ¶

**å¢é‡æ‰“åŒ…ï¼š**
```bash
# æ£€æŸ¥æ¨¡å—æ˜¯å¦éœ€è¦é‡æ–°æ‰“åŒ…
needs_repackaging() {
    local module_path="$1"
    local package_file="$2"
    
    # å¦‚æœåŒ…ä¸å­˜åœ¨ï¼Œéœ€è¦æ‰“åŒ…
    if [ ! -f "$package_file" ]; then
        return 0
    fi
    
    # æ£€æŸ¥æºæ–‡ä»¶æ˜¯å¦æ¯”åŒ…æ›´æ–°
    if [ "$module_path" -nt "$package_file" ]; then
        return 0
    fi
    
    # ä¸éœ€è¦é‡æ–°æ‰“åŒ…
    return 1
}
```

## ğŸ› ï¸ é«˜çº§æ‰“åŒ…åŠŸèƒ½

### ä¾èµ–å…³ç³»å¤„ç†

**æ¨¡å—ä¾èµ–æ£€æŸ¥ï¼š**
```bash
# è§£ææ¨¡å—ä¾èµ–
parse_dependencies() {
    local info_file="$1"
    
    # æå–dependencieså­—æ®µ
    local deps=$(grep "dependencies[[:space:]]*=" "$info_file" | sed 's/.*=[[:space:]]*"\([^"]*\)".*/\1/')
    
    if [ -n "$deps" ]; then
        echo "æ¨¡å—ä¾èµ–: $deps"
        # TODO: éªŒè¯ä¾èµ–æ¨¡å—æ˜¯å¦å­˜åœ¨
    fi
}
```

### ç‰ˆæœ¬å…¼å®¹æ€§æ£€æŸ¥

**CHTLç‰ˆæœ¬éªŒè¯ï¼š**
```bash
# æ£€æŸ¥CHTLç‰ˆæœ¬å…¼å®¹æ€§
check_version_compatibility() {
    local info_file="$1"
    
    local min_version=$(grep "minCHTLVersion" "$info_file" | sed 's/.*=[[:space:]]*"\([^"]*\)".*/\1/')
    local max_version=$(grep "maxCHTLVersion" "$info_file" | sed 's/.*=[[:space:]]*"\([^"]*\)".*/\1/')
    
    if [ -n "$min_version" ]; then
        echo "æœ€ä½CHTLç‰ˆæœ¬è¦æ±‚: $min_version"
    fi
    
    if [ -n "$max_version" ]; then
        echo "æœ€é«˜CHTLç‰ˆæœ¬æ”¯æŒ: $max_version"
    fi
}
```

### æ•°å­—ç­¾åæ”¯æŒ

**åŒ…ç­¾åéªŒè¯ï¼š**
```bash
# ä¸ºåŒ…æ·»åŠ æ•°å­—ç­¾åï¼ˆå¯é€‰åŠŸèƒ½ï¼‰
sign_package() {
    local package_file="$1"
    local private_key="$2"
    
    if [ -f "$private_key" ] && command -v openssl >/dev/null 2>&1; then
        echo "ä¸ºåŒ…æ·»åŠ æ•°å­—ç­¾å..."
        openssl dgst -sha256 -sign "$private_key" -out "${package_file}.sig" "$package_file"
        echo "ç­¾åæ–‡ä»¶: ${package_file}.sig"
    fi
}
```

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§æ‰“åŒ…é—®é¢˜

**é—®é¢˜1ï¼šæ¨¡å—è·¯å¾„é”™è¯¯**
```
é”™è¯¯ï¼šModule path not found: Chtholly\CMOD\Core
è§£å†³ï¼š
1. æ£€æŸ¥è·¯å¾„åˆ†éš”ç¬¦ï¼ˆWindowsç”¨\ï¼ŒLinux/macOSç”¨/ï¼‰
2. ç¡®è®¤æ¨¡å—ç›®å½•ç¡®å®å­˜åœ¨
3. æ£€æŸ¥è·¯å¾„æ‹¼å†™æ˜¯å¦æ­£ç¡®
```

**é—®é¢˜2ï¼šæ–‡ä»¶æƒé™é—®é¢˜**
```
é”™è¯¯ï¼šPermission denied when creating package
è§£å†³ï¼š
1. chmod +x scripts/linux/*.sh
2. ç¡®ä¿å¯¹distç›®å½•æœ‰å†™æƒé™
3. æ£€æŸ¥ä¸´æ—¶ç›®å½•æƒé™
```

**é—®é¢˜3ï¼šZIPå‘½ä»¤ç¼ºå¤±**
```
é”™è¯¯ï¼šzip: command not found
è§£å†³ï¼š
1. Linux: sudo apt install zip
2. macOS: brew install zip
3. Windows: è„šæœ¬ä½¿ç”¨PowerShellå‹ç¼©
```

**é—®é¢˜4ï¼šåŒ…æ–‡ä»¶æŸå**
```
é”™è¯¯ï¼šPackage file is corrupted
è§£å†³ï¼š
1. æ£€æŸ¥ç£ç›˜ç©ºé—´æ˜¯å¦å……è¶³
2. éªŒè¯æºæ–‡ä»¶å®Œæ•´æ€§
3. é‡æ–°è¿è¡Œæ‰“åŒ…è„šæœ¬
```

**é—®é¢˜5ï¼šæ¨¡å—ç»“æ„ä¸ç¬¦åˆè§„èŒƒ**
```
è­¦å‘Šï¼šMain source file not found
è§£å†³ï¼š
1. ç¡®ä¿srcç›®å½•åŒ…å«ModuleName.chtl
2. ç¡®ä¿infoç›®å½•åŒ…å«ModuleName.chtl
3. æ£€æŸ¥æ–‡ä»¶åå¤§å°å†™
```

### è°ƒè¯•æ¨¡å¼

**å¯ç”¨è¯¦ç»†è¾“å‡ºï¼š**
```bash
# è®¾ç½®è°ƒè¯•æ¨¡å¼
export CHTL_PACKAGE_DEBUG=1

# è¿è¡Œæ‰“åŒ…è„šæœ¬
scripts/linux/package_cmod.sh Chtholly/CMOD/Core
```

**è°ƒè¯•è¾“å‡ºç¤ºä¾‹ï¼š**
```
[DEBUG] æ¨¡å—è·¯å¾„: Chtholly/CMOD/Core
[DEBUG] æ¨¡å—åç§°: Core
[DEBUG] ä¸´æ—¶ç›®å½•: /tmp/chtl_cmod_package_12345
[DEBUG] å¤åˆ¶srcç›®å½•...
[DEBUG] å¤åˆ¶infoç›®å½•...
[DEBUG] éªŒè¯æ–‡ä»¶ç»“æ„...
[DEBUG] åˆ›å»ºå‹ç¼©åŒ…...
[DEBUG] æ¸…ç†ä¸´æ—¶æ–‡ä»¶...
[INFO] æ‰“åŒ…å®Œæˆ: dist/modules/Core.cmod
```

## ğŸ“ˆ ç»Ÿè®¡ä¿¡æ¯å’ŒæŠ¥å‘Š

### æ‰“åŒ…ç»Ÿè®¡

**ç”Ÿæˆæ‰“åŒ…æŠ¥å‘Šï¼š**
```bash
# ç»Ÿè®¡æ‰“åŒ…ä¿¡æ¯
generate_package_report() {
    local package_file="$1"
    local module_name="$2"
    
    echo "===================="
    echo "æ¨¡å—æ‰“åŒ…æŠ¥å‘Š"
    echo "===================="
    echo "æ¨¡å—åç§°: $module_name"
    echo "åŒ…æ–‡ä»¶: $package_file"
    echo "æ–‡ä»¶å¤§å°: $(du -h "$package_file" | cut -f1)"
    echo "åˆ›å»ºæ—¶é—´: $(date)"
    
    # åŒ…å†…å®¹ç»Ÿè®¡
    if command -v unzip >/dev/null 2>&1; then
        echo "åŒ…å«æ–‡ä»¶:"
        unzip -l "$package_file" | tail -n +4 | head -n -2
    fi
    
    echo "===================="
}
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [æ„å»ºè„šæœ¬è¯´æ˜æ–‡æ¡£](./æ„å»ºè„šæœ¬è¯´æ˜æ–‡æ¡£.md) - å®Œæ•´æ„å»ºæµç¨‹
- [CHTLè¯­æ³•æ–‡æ¡£](./CHTLè¯­æ³•æ–‡æ¡£æ›´æ–°ç‰ˆ.md) - æ¨¡å—è¯­æ³•è§„èŒƒ
- [ç‚æœµè‰æ¨¡å—ä½¿ç”¨æ–‡æ¡£](./ç‚æœµè‰æ¨¡å—ä½¿ç”¨æ–‡æ¡£.md) - æ··åˆæ¨¡å—ç¤ºä¾‹
- [ç”±æ¯”æ»¨ç»“è¡£æ¨¡å—ä½¿ç”¨æ–‡æ¡£](./ç”±æ¯”æ»¨ç»“è¡£æ¨¡å—ä½¿ç”¨æ–‡æ¡£.md) - çº¯CMODæ¨¡å—ç¤ºä¾‹
- [é¡¹ç›®æ„å»ºæŒ‡å—](./é¡¹ç›®æ„å»ºæŒ‡å—.md) - æ•´ä½“æ„å»ºè¯´æ˜

## ğŸ“„ è®¸å¯è¯

æœ¬æ‰“åŒ…è„šæœ¬ç³»ç»Ÿéµå¾ªMITè®¸å¯è¯ï¼Œè¯¦è§ [LICENSE](../LICENSE) æ–‡ä»¶ã€‚