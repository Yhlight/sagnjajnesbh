// ========================================
// üöÄ CJMODÁºñËØëËæìÂá∫ - C++Êâ©Â±ïËØ≠Ê≥ïËΩ¨Êç¢ÊàêÁöÑJavaScript‰ª£Á†Å
// ËøôÂ±ïÁ§∫‰∫ÜCJMODÁöÑÊ†∏ÂøÉÂ∑•‰ΩúÂéüÁêÜ
// ========================================

let timerController = null;

// ========================================
// CJMODÊâ©Â±ïËØ≠Ê≥ïÁºñËØëÁªìÊûú
// ========================================

// üé® animateÊâ©Â±ïËØ≠Ê≥ïÁºñËØëÁªìÊûú
document.getElementById('bounce-btn').addEventListener('click', function() {
    // animate({target: {{#animate-box}}, effect: 'bounce', duration: 800})
    // ‚Üì C++Â§ÑÁêÜÂêéÁîüÊàêÁöÑJavaScript‰ª£Á†ÅÔºö
    (() => {
        const element = document.getElementById('animate-box');
        if (!element) return;
        
        // ÂºπË∑≥Âä®ÁîªÊïàÊûú
        element.animate([
            { transform: 'translateY(0px)' },
            { transform: 'translateY(-20px)' },
            { transform: 'translateY(0px)' },
            { transform: 'translateY(-10px)' },
            { transform: 'translateY(0px)' }
        ], {
            duration: 800,
            easing: 'cubic-bezier(0.68, -0.55, 0.265, 1.55)'
        });
    })();
    
    document.getElementById('animate-output').textContent = '‚úÖ ÂºπË∑≥Âä®ÁîªÂ∑≤Ëß¶Âèë';
});

document.getElementById('shake-btn').addEventListener('click', function() {
    // animate({target: {{#animate-box}}, effect: 'shake', duration: 600})
    // ‚Üì C++Â§ÑÁêÜÂêéÁîüÊàêÁöÑJavaScript‰ª£Á†ÅÔºö
    (() => {
        const element = document.getElementById('animate-box');
        if (!element) return;
        
        // ÈúáÂä®Âä®ÁîªÊïàÊûú
        element.animate([
            { transform: 'translateX(0px)' },
            { transform: 'translateX(-10px)' },
            { transform: 'translateX(10px)' },
            { transform: 'translateX(-5px)' },
            { transform: 'translateX(5px)' },
            { transform: 'translateX(0px)' }
        ], {
            duration: 600,
            easing: 'ease-in-out'
        });
    })();
    
    document.getElementById('animate-output').textContent = '‚úÖ ÈúáÂä®Âä®ÁîªÂ∑≤Ëß¶Âèë';
});

// üíæ storageÊâ©Â±ïËØ≠Ê≥ïÁºñËØëÁªìÊûú
document.getElementById('save-btn').addEventListener('click', function() {
    const key = document.getElementById('storage-key').value;
    const value = document.getElementById('storage-value').value;
    
    if (key && value) {
        // storage.set(key, value)
        // ‚Üì C++Â§ÑÁêÜÂêéÁîüÊàêÁöÑJavaScript‰ª£Á†ÅÔºö
        const success = (() => {
            try {
                const data = {
                    value: value,
                    timestamp: Date.now(),
                    type: typeof(value)
                };
                localStorage.setItem(key, JSON.stringify(data));
                console.log('üíæ Â≠òÂÇ®ÊàêÂäü:', key, data.value);
                return true;
            } catch (e) {
                console.error('‚ùå Â≠òÂÇ®Â§±Ë¥•:', e);
                return false;
            }
        })();
        
        document.getElementById('storage-output').textContent = success ? 
            '‚úÖ Êï∞ÊçÆ‰øùÂ≠òÊàêÂäü' : '‚ùå ‰øùÂ≠òÂ§±Ë¥•';
    }
});

document.getElementById('load-btn').addEventListener('click', function() {
    const key = document.getElementById('storage-key').value;
    
    if (key) {
        // storage.get(key, 'Êú™ÊâæÂà∞Êï∞ÊçÆ')
        // ‚Üì C++Â§ÑÁêÜÂêéÁîüÊàêÁöÑJavaScript‰ª£Á†ÅÔºö
        const value = (() => {
            try {
                const stored = localStorage.getItem(key);
                if (!stored) return 'Êú™ÊâæÂà∞Êï∞ÊçÆ';
                
                const data = JSON.parse(stored);
                console.log('üìÅ ËØªÂèñÊàêÂäü:', key, data.value);
                
                // Á±ªÂûãËøòÂéü
                if (data.type === 'number') return Number(data.value);
                if (data.type === 'boolean') return Boolean(data.value);
                return data.value;
            } catch (e) {
                console.error('‚ùå ËØªÂèñÂ§±Ë¥•:', e);
                return 'Êú™ÊâæÂà∞Êï∞ÊçÆ';
            }
        })();
        
        document.getElementById('storage-output').textContent = `üìÅ ËØªÂèñÁªìÊûú: ${value}`;
    }
});

// üåê httpÊâ©Â±ïËØ≠Ê≥ïÁºñËØëÁªìÊûú
document.getElementById('get-btn').addEventListener('click', async function() {
    const url = document.getElementById('api-url').value;
    
    document.getElementById('http-output').textContent = 'üåê Ê≠£Âú®ËØ∑Ê±Ç...';
    
    // http.get(url)
    // ‚Üì C++Â§ÑÁêÜÂêéÁîüÊàêÁöÑJavaScript‰ª£Á†ÅÔºö
    const result = await (async () => {
        try {
            console.log('üåê ÂèëÈÄÅGETËØ∑Ê±Ç:', url);
            
            const response = await fetch(url, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                    'User-Agent': 'CHTL-JS/1.0'
                }
            });
            
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }
            
            const data = await response.json();
            console.log('‚úÖ ËØ∑Ê±ÇÊàêÂäü:', data);
            return data;
        } catch (error) {
            console.error('‚ùå ËØ∑Ê±ÇÂ§±Ë¥•:', error);
            return { error: error.message };
        }
    })();
    
    document.getElementById('http-output').textContent = `‚úÖ ËØ∑Ê±ÇÂÆåÊàê: ${JSON.stringify(result, null, 2)}`;
});

// ‚è∞ timerÊâ©Â±ïËØ≠Ê≥ïÁºñËØëÁªìÊûú
document.getElementById('timer-after-btn').addEventListener('click', function() {
    document.getElementById('timer-output').textContent = '‚è∞ 3ÁßíÂêéÂ∞ÜÊâßË°å...';
    
    // timer.after(3000, callback)
    // ‚Üì C++Â§ÑÁêÜÂêéÁîüÊàêÁöÑJavaScript‰ª£Á†ÅÔºö
    (() => {
        const timerId = setTimeout(() => {
            try {
                console.log('‚è∞ ÂÆöÊó∂Âô®Ëß¶Âèë:', 3000, 'ms');
                (function() {
                    document.getElementById('timer-output').textContent = '‚úÖ ÂÆöÊó∂‰ªªÂä°ÊâßË°åÂÆåÊàêÔºÅ';
                    
                    // notification.show('ÂÆöÊó∂Âô®', '3ÁßíÂÆöÊó∂‰ªªÂä°ÂÆåÊàêÔºÅ', 'success')
                    // ‚Üì C++Â§ÑÁêÜÂêéÁîüÊàêÁöÑJavaScript‰ª£Á†ÅÔºö
                    (() => {
                        // ÂàõÂª∫ÈÄöÁü•ÂÆπÂô®ÔºàÂ¶ÇÊûú‰∏çÂ≠òÂú®Ôºâ
                        let container = document.getElementById('chtl_notification_container');
                        if (!container) {
                            container = document.createElement('div');
                            container.id = 'chtl_notification_container';
                            container.style.position = 'fixed';
                            container.style.top = '20px';
                            container.style.right = '20px';
                            container.style.zIndex = '9999';
                            document.body.appendChild(container);
                        }
                        
                        // ÂàõÂª∫ÈÄöÁü•ÂÖÉÁ¥†
                        const notification = document.createElement('div');
                        const notificationId = 'notification_' + Date.now();
                        notification.id = notificationId;
                        
                        // ËÆæÁΩÆÊ†∑Âºè
                        const colors = {
                            success: { bg: '#4caf50', icon: '‚úÖ' },
                            error: { bg: '#f44336', icon: '‚ùå' },
                            warning: { bg: '#ff9800', icon: '‚ö†Ô∏è' },
                            info: { bg: '#2196f3', icon: '‚ÑπÔ∏è' }
                        };
                        
                        const color = colors['success'] || colors.info;
                        
                        notification.style.cssText = `
                            background: ${color.bg};
                            color: white;
                            padding: 15px 20px;
                            border-radius: 8px;
                            margin-bottom: 10px;
                            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                            transform: translateX(100%);
                            transition: all 0.3s ease;
                            cursor: pointer;
                            max-width: 350px;
                            word-wrap: break-word;
                        `;
                        
                        notification.innerHTML = `
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span style="font-size: 18px;">${color.icon}</span>
                                <div>
                                    <div style="font-weight: bold; margin-bottom: 4px;">ÂÆöÊó∂Âô®</div>
                                    <div style="font-size: 14px; opacity: 0.9;">3ÁßíÂÆöÊó∂‰ªªÂä°ÂÆåÊàêÔºÅ</div>
                                </div>
                                <span style="margin-left: auto; opacity: 0.7; cursor: pointer;">√ó</span>
                            </div>
                        `;
                        
                        // Ê∑ªÂä†Âà∞ÂÆπÂô®
                        container.appendChild(notification);
                        
                        // Âä®ÁîªËøõÂÖ•
                        setTimeout(() => {
                            notification.style.transform = 'translateX(0)';
                        }, 10);
                        
                        // ÁÇπÂáªÂÖ≥Èó≠
                        notification.addEventListener('click', () => {
                            notification.style.transform = 'translateX(100%)';
                            setTimeout(() => {
                                if (notification.parentNode) {
                                    notification.parentNode.removeChild(notification);
                                }
                            }, 300);
                        });
                        
                        // Ëá™Âä®Ê∂àÂ§±
                        setTimeout(() => {
                            if (notification.parentNode) {
                                notification.style.transform = 'translateX(100%)';
                                setTimeout(() => {
                                    if (notification.parentNode) {
                                        notification.parentNode.removeChild(notification);
                                    }
                                }, 300);
                            }
                        }, 4000);
                        
                        console.log('üîî ÈÄöÁü•Â∑≤ÊòæÁ§∫:', 'ÂÆöÊó∂Âô®');
                        return notificationId;
                    })();
                })();
            } catch (error) {
                console.error('‚ùå ÂÆöÊó∂Âô®ÂõûË∞ÉÈîôËØØ:', error);
            }
        }, 3000);
        
        // ËøîÂõûÂèñÊ∂àÂáΩÊï∞
        return () => {
            clearTimeout(timerId);
            console.log('‚èπÔ∏è ÂÆöÊó∂Âô®Â∑≤ÂèñÊ∂à');
        };
    })();
});

// üßÆ mathÊâ©Â±ïËØ≠Ê≥ïÁºñËØëÁªìÊûú
document.getElementById('calculate-btn').addEventListener('click', function() {
    const expression = document.getElementById('math-expression').value;
    
    // math.calculate(expression, 4)
    // ‚Üì C++Â§ÑÁêÜÂêéÁîüÊàêÁöÑJavaScript‰ª£Á†ÅÔºö
    const result = (() => {
        try {
            const expression = document.getElementById('math-expression').value;
            console.log('üßÆ ËÆ°ÁÆóË°®ËææÂºè:', expression);
            
            // ÂÆâÂÖ®ÁöÑË°®ËææÂºèÈ™åËØÅ
            const safeExpression = expression.replace(/[^0-9+\-*/.() ]/g, '');
            if (safeExpression !== expression) {
                throw new Error('Ë°®ËææÂºèÂåÖÂê´ÈùûÊ≥ïÂ≠óÁ¨¶');
            }
            
            // ËÆ°ÁÆóÁªìÊûú
            const result = Function('"use strict"; return (' + safeExpression + ')')();
            const roundedResult = Number(result.toFixed(4));
            
            console.log('‚úÖ ËÆ°ÁÆóÁªìÊûú:', expression, '=', roundedResult);
            return roundedResult;
        } catch (error) {
            console.error('‚ùå ËÆ°ÁÆóÈîôËØØ:', error);
            return NaN;
        }
    })();
    
    document.getElementById('math-output').textContent = `üßÆ ËÆ°ÁÆóÁªìÊûú: ${expression} = ${result}`;
    
    // notification.showÁºñËØëÁªìÊûúÔºàÁúÅÁï•Ôºå‰∏é‰∏äÈù¢Áõ∏ÂêåÔºâ
});

// üéØ ÂàùÂßãÂåñÂáΩÊï∞
function initDemo() {
    console.log('üöÄ CJMODËØ≠Ê≥ïÊâ©Â±ïÊºîÁ§∫ÂàùÂßãÂåñ...');
    
    // notification.showÁºñËØëÁªìÊûú
    (() => {
        // ... ÈÄöÁü•ÊòæÁ§∫‰ª£Á†ÅÔºà‰∏é‰∏äÈù¢Áõ∏ÂêåÔºâ
    })();
    
    // storage.getÁºñËØëÁªìÊûú
    const demoCount = (() => {
        try {
            const stored = localStorage.getItem('demo_count');
            if (!stored) return 0;
            
            const data = JSON.parse(stored);
            console.log('üìÅ ËØªÂèñÊàêÂäü:', 'demo_count', data.value);
            
            if (data.type === 'number') return Number(data.value);
            if (data.type === 'boolean') return Boolean(data.value);
            return data.value;
        } catch (e) {
            console.error('‚ùå ËØªÂèñÂ§±Ë¥•:', e);
            return 0;
        }
    })();
    
    if (demoCount > 0) {
        // Âèà‰∏Ä‰∏™notification.showÁºñËØëÁªìÊûú...
    }
    
    // ËÆæÁΩÆÁ§∫‰æãÂÄº
    document.getElementById('storage-key').value = 'test_key';
    document.getElementById('storage-value').value = 'Hello CJMOD!';
    document.getElementById('email-input').value = 'test@example.com';
    document.getElementById('phone-input').value = '13812345678';
    
    console.log('‚úÖ ÊºîÁ§∫ÂàùÂßãÂåñÂÆåÊàêÔºÅ');
    console.log('üí° ÊâÄÊúâÊåâÈíÆÈÉΩ‰ΩøÁî®‰∫ÜC++ÁºñÂÜôÁöÑCJMODËØ≠Ê≥ïÊâ©Â±ï');
}

// ÂêØÂä®ÊºîÁ§∫
initDemo();