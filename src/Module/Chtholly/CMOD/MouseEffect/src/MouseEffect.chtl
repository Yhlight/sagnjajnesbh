// æŒ‰CHTLè¯­æ³•æ–‡æ¡£ï¼šä½¿ç”¨[Custom] @Elementå®šä¹‰ç»„ä»¶ï¼Œä½¿ç”¨å±€éƒ¨styleå’Œscript
// ç‚æœµè‰é¼ æ ‡ç‰¹æ•ˆ - å¦‚æ˜Ÿå…‰èˆ¬é—ªè€€çš„è¿½éšæ•ˆæœ
[Custom] @Element ChthollyMouseEffect
{
    div
    {
        class: "chtholly-mouse-effect";
        
        style
        {
            .chtholly-mouse-effect
            {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                pointer-events: none;
                z-index: 9999;
                overflow: hidden;
            }
            
            .mouse-sparkle
            {
                position: absolute;
                width: 6px;
                height: 6px;
                background: radial-gradient(circle, #ffb6c1 0%, #ff69b4 50%, transparent 100%);
                border-radius: 50%;
                pointer-events: none;
                animation: sparkleLife 1.5s ease-out forwards;
            }
            
            .mouse-sparkle.large
            {
                width: 10px;
                height: 10px;
                background: radial-gradient(circle, #fff 0%, #ffb6c1 30%, #ff69b4 70%, transparent 100%);
            }
            
            .mouse-sparkle.small
            {
                width: 4px;
                height: 4px;
            }
            
            @keyframes sparkleLife
            {
                0% {
                    opacity: 1;
                    transform: scale(0) rotate(0deg);
                }
                20% {
                    opacity: 1;
                    transform: scale(1) rotate(90deg);
                }
                100% {
                    opacity: 0;
                    transform: scale(0.3) rotate(360deg);
                }
            }
            
            .mouse-cursor-glow
            {
                position: absolute;
                width: 20px;
                height: 20px;
                background: radial-gradient(circle, rgba(255, 182, 193, 0.8) 0%, rgba(255, 105, 180, 0.4) 50%, transparent 100%);
                border-radius: 50%;
                pointer-events: none;
                transform: translate(-50%, -50%);
                transition: all 0.1s ease-out;
                z-index: 10000;
            }
            
            .mouse-trail-particle
            {
                position: absolute;
                width: 3px;
                height: 3px;
                background: #ffb6c1;
                border-radius: 50%;
                pointer-events: none;
                animation: trailFade 0.8s ease-out forwards;
            }
            
            @keyframes trailFade
            {
                0% {
                    opacity: 0.8;
                    transform: scale(1);
                }
                100% {
                    opacity: 0;
                    transform: scale(0.2);
                }
            }
            
            .click-ripple
            {
                position: absolute;
                border: 2px solid #ff69b4;
                border-radius: 50%;
                background: radial-gradient(circle, rgba(255, 182, 193, 0.3) 0%, transparent 70%);
                pointer-events: none;
                animation: rippleExpand 0.6s ease-out forwards;
            }
            
            @keyframes rippleExpand
            {
                0% {
                    width: 0;
                    height: 0;
                    opacity: 1;
                }
                100% {
                    width: 60px;
                    height: 60px;
                    opacity: 0;
                }
            }
            
            .heart-particle
            {
                position: absolute;
                font-size: 12px;
                color: #ff69b4;
                pointer-events: none;
                animation: heartFloat 2s ease-out forwards;
                user-select: none;
            }
            
            @keyframes heartFloat
            {
                0% {
                    opacity: 1;
                    transform: translateY(0) scale(1) rotate(0deg);
                }
                100% {
                    opacity: 0;
                    transform: translateY(-50px) scale(1.5) rotate(15deg);
                }
            }
        }
        
        script
        {
            // æŒ‰CHTLè¯­æ³•æ–‡æ¡£ï¼šä½¿ç”¨è™šå¯¹è±¡å’Œå¢å¼ºé€‰æ‹©å™¨ç®¡ç†é¼ æ ‡ç‰¹æ•ˆ
            vir mouseEffectController = iNeverAway({
                Init: function() {
                    this.isActive = true;
                    this.lastSparkleTime = 0;
                    this.lastTrailTime = 0;
                    this.trailParticles = [];
                    this.sparkleCount = 0;
                    
                    console.log('ğŸŒ¸ ç‚æœµè‰çš„é¼ æ ‡ç‰¹æ•ˆå·²å¯åŠ¨ï¼Œå¦‚æ˜Ÿå…‰èˆ¬é—ªè€€...');
                },
                
                CreateSparkle: function(x, y) {
                    if (!this.isActive) return;
                    
                    const now = Date.now();
                    if (now - this.lastSparkleTime < 50) return; // é™åˆ¶é¢‘ç‡
                    this.lastSparkleTime = now;
                    
                    const sparkle = document.createElement('div');
                    sparkle.className = 'mouse-sparkle';
                    
                    // éšæœºå¤§å°
                    const rand = Math.random();
                    if (rand > 0.8) sparkle.classList.add('large');
                    else if (rand < 0.3) sparkle.classList.add('small');
                    
                    // éšæœºä½ç½®åç§»
                    const offsetX = (Math.random() - 0.5) * 20;
                    const offsetY = (Math.random() - 0.5) * 20;
                    
                    sparkle.style.left = (x + offsetX) + 'px';
                    sparkle.style.top = (y + offsetY) + 'px';
                    
                    {{.chtholly-mouse-effect}}.appendChild(sparkle);
                    
                    // è‡ªåŠ¨æ¸…ç†
                    setTimeout(() => {
                        if (sparkle.parentNode) {
                            sparkle.remove();
                        }
                    }, 1500);
                },
                
                CreateTrailParticle: function(x, y) {
                    if (!this.isActive) return;
                    
                    const now = Date.now();
                    if (now - this.lastTrailTime < 20) return; // æ›´é«˜é¢‘ç‡çš„æ‹–å°¾
                    this.lastTrailTime = now;
                    
                    const particle = document.createElement('div');
                    particle.className = 'mouse-trail-particle';
                    particle.style.left = x + 'px';
                    particle.style.top = y + 'px';
                    
                    {{.chtholly-mouse-effect}}.appendChild(particle);
                    
                    // è‡ªåŠ¨æ¸…ç†
                    setTimeout(() => {
                        if (particle.parentNode) {
                            particle.remove();
                        }
                    }, 800);
                },
                
                CreateClickRipple: function(x, y) {
                    const ripple = document.createElement('div');
                    ripple.className = 'click-ripple';
                    ripple.style.left = (x - 30) + 'px';
                    ripple.style.top = (y - 30) + 'px';
                    
                    {{.chtholly-mouse-effect}}.appendChild(ripple);
                    
                    setTimeout(() => {
                        if (ripple.parentNode) {
                            ripple.remove();
                        }
                    }, 600);
                },
                
                CreateHeartParticle: function(x, y) {
                    const hearts = ['ğŸ’•', 'ğŸ’–', 'ğŸ’—', 'ğŸ’', 'ğŸŒ¸', 'âœ¨'];
                    const heart = document.createElement('div');
                    heart.className = 'heart-particle';
                    heart.textContent = hearts[Math.floor(Math.random() * hearts.length)];
                    heart.style.left = x + 'px';
                    heart.style.top = y + 'px';
                    
                    {{.chtholly-mouse-effect}}.appendChild(heart);
                    
                    setTimeout(() => {
                        if (heart.parentNode) {
                            heart.remove();
                        }
                    }, 2000);
                },
                
                UpdateCursorGlow: function(x, y) {
                    let glow = {{.mouse-cursor-glow}};
                    if (!glow) {
                        glow = document.createElement('div');
                        glow.className = 'mouse-cursor-glow';
                        {{.chtholly-mouse-effect}}.appendChild(glow);
                    }
                    
                    glow.style.left = x + 'px';
                    glow.style.top = y + 'px';
                },
                
                Toggle: function() {
                    this.isActive = !this.isActive;
                    if (this.isActive) {
                        console.log('ğŸŒ¸ ç‚æœµè‰çš„é¼ æ ‡ç‰¹æ•ˆå·²å¯ç”¨');
                    } else {
                        console.log('ğŸŒ¸ ç‚æœµè‰çš„é¼ æ ‡ç‰¹æ•ˆå·²ç¦ç”¨');
                        // æ¸…ç†æ‰€æœ‰ç‰¹æ•ˆ
                        {{.mouse-sparkle}}.forEach(el => el.remove());
                        {{.mouse-trail-particle}}.forEach(el => el.remove());
                    }
                }
            });
            
            // é¼ æ ‡ç§»åŠ¨äº‹ä»¶
            {{document}}->listen({
                mousemove: function(event) {
                    if (!mouseEffectController.isActive) return;
                    
                    const x = event.clientX;
                    const y = event.clientY;
                    
                    // æ›´æ–°å…‰æ™•
                    mouseEffectController->UpdateCursorGlow(x, y);
                    
                    // åˆ›å»ºæ‹–å°¾ç²’å­
                    mouseEffectController->CreateTrailParticle(x, y);
                    
                    // éšæœºåˆ›å»ºæ˜Ÿå…‰
                    if (Math.random() > 0.9) {
                        mouseEffectController->CreateSparkle(x, y);
                    }
                }
            });
            
            // é¼ æ ‡ç‚¹å‡»äº‹ä»¶
            {{document}}->listen({
                click: function(event) {
                    if (!mouseEffectController.isActive) return;
                    
                    const x = event.clientX;
                    const y = event.clientY;
                    
                    // åˆ›å»ºç‚¹å‡»æ¶Ÿæ¼ª
                    mouseEffectController->CreateClickRipple(x, y);
                    
                    // åˆ›å»ºçˆ±å¿ƒç²’å­
                    mouseEffectController->CreateHeartParticle(x, y);
                }
            });
            
            // åŒå‡»åˆ›å»ºç‰¹æ®Šæ•ˆæœ
            {{document}}->listen({
                dblclick: function(event) {
                    if (!mouseEffectController.isActive) return;
                    
                    const x = event.clientX;
                    const y = event.clientY;
                    
                    // åˆ›å»ºå¤šä¸ªçˆ±å¿ƒ
                    for (let i = 0; i < 5; i++) {
                        setTimeout(() => {
                            const offsetX = (Math.random() - 0.5) * 40;
                            const offsetY = (Math.random() - 0.5) * 40;
                            mouseEffectController->CreateHeartParticle(x + offsetX, y + offsetY);
                        }, i * 100);
                    }
                }
            });
            
            // é”®ç›˜å¿«æ·é”®åˆ‡æ¢
            {{document}}->listen({
                keydown: function(event) {
                    if (event.ctrlKey && event.key === 'm') {
                        event.preventDefault();
                        mouseEffectController->Toggle();
                    }
                }
            });
            
            // åˆå§‹åŒ–
            {{document}}->listen({
                DOMContentLoaded: function() {
                    mouseEffectController->Init();
                    console.log('ğŸŒ¸ ç‚æœµè‰çš„é¼ æ ‡ç‰¹æ•ˆå·²å‡†å¤‡å°±ç»ªï¼æŒ‰Ctrl+Må¯ä»¥åˆ‡æ¢æ•ˆæœ');
                }
            });
            
            // é¡µé¢å¯è§æ€§æ§åˆ¶
            {{document}}->listen({
                visibilitychange: function() {
                    if (document.hidden) {
                        mouseEffectController.isActive = false;
                    } else {
                        mouseEffectController.isActive = true;
                    }
                }
            });
        }
    }
}

// æŒ‰CHTLè¯­æ³•æ–‡æ¡£ï¼šå®šä¹‰ç›¸å…³çš„è‡ªå®šä¹‰æ ·å¼ç»„
[Custom] @Style ChthollyMouseEffectStyle
{
    sparkle-color,
    glow-color,
    trail-color;
    
    position: fixed;
    pointer-events: none;
    z-index: 9999;
}