// 按CHTL语法文档：使用[Custom] @Element定义组件，使用局部style和script
// 珂朵莉暖色笔记 - 记录最珍贵的回忆时光
[Custom] @Element ChthollyWarmNote
{
    div
    {
        class: "chtholly-warm-note";
        
        style
        {
            .chtholly-warm-note
            {
                max-width: 500px;
                margin: 20px auto;
                background: linear-gradient(135deg, #fff8dc 0%, #ffefd5 50%, #ffe4e1 100%);
                border-radius: 20px;
                padding: 25px;
                box-shadow: 
                    0 10px 30px rgba(255, 218, 185, 0.3),
                    inset 0 1px 0 rgba(255, 255, 255, 0.8);
                border: 3px solid #ffd4a3;
                font-family: "Georgia", "Times New Roman", serif;
                position: relative;
                overflow: hidden;
            }
            
            .chtholly-warm-note::before
            {
                content: '';
                position: absolute;
                top: -50%;
                left: -50%;
                width: 200%;
                height: 200%;
                background: radial-gradient(circle, rgba(255, 218, 185, 0.1) 0%, transparent 70%);
                animation: warmGlow 4s ease-in-out infinite alternate;
            }
            
            @keyframes warmGlow
            {
                0% { transform: rotate(0deg) scale(1); opacity: 0.3; }
                100% { transform: rotate(180deg) scale(1.1); opacity: 0.1; }
            }
            
            .note-header
            {
                text-align: center;
                margin-bottom: 25px;
                position: relative;
                z-index: 2;
            }
            
            .note-title
            {
                font-size: 24px;
                font-weight: 300;
                color: #d2691e;
                text-shadow: 0 2px 4px rgba(210, 105, 30, 0.1);
                margin-bottom: 8px;
                font-family: "Brush Script MT", cursive;
            }
            
            .note-subtitle
            {
                font-size: 14px;
                color: #cd853f;
                opacity: 0.8;
                font-style: italic;
            }
            
            .note-editor
            {
                position: relative;
                z-index: 2;
                margin-bottom: 20px;
            }
            
            .note-textarea
            {
                width: 100%;
                min-height: 200px;
                padding: 20px;
                border: 2px solid #f4a460;
                border-radius: 15px;
                background: linear-gradient(to bottom, rgba(255, 255, 255, 0.9), rgba(255, 248, 220, 0.9));
                color: #8b4513;
                font-size: 16px;
                line-height: 1.8;
                font-family: "Georgia", serif;
                resize: vertical;
                transition: all 0.3s ease;
                box-shadow: inset 0 2px 8px rgba(244, 164, 96, 0.1);
            }
            
            &:focus .note-textarea
            {
                border-color: #daa520;
                outline: none;
                box-shadow: 
                    inset 0 2px 8px rgba(244, 164, 96, 0.2),
                    0 0 0 4px rgba(218, 165, 32, 0.1);
                background: linear-gradient(to bottom, rgba(255, 255, 255, 1), rgba(255, 248, 220, 1));
            }
            
            .note-toolbar
            {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 15px;
                position: relative;
                z-index: 2;
            }
            
            .toolbar-group
            {
                display: flex;
                gap: 8px;
            }
            
            .toolbar-btn
            {
                padding: 8px 12px;
                border: none;
                border-radius: 20px;
                background: linear-gradient(45deg, #ffd4a3, #ffcc99);
                color: #8b4513;
                font-size: 12px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s ease;
                box-shadow: 0 2px 8px rgba(255, 212, 163, 0.3);
                text-transform: uppercase;
                letter-spacing: 0.5px;
            }
            
            &:hover .toolbar-btn
            {
                background: linear-gradient(45deg, #ffcc99, #ffb366);
                transform: translateY(-2px);
                box-shadow: 0 4px 15px rgba(255, 212, 163, 0.5);
            }
            
            .note-stats
            {
                display: flex;
                gap: 15px;
                font-size: 12px;
                color: #cd853f;
                opacity: 0.7;
            }
            
            .stat-item
            {
                display: flex;
                align-items: center;
                gap: 4px;
            }
            
            .note-footer
            {
                text-align: center;
                padding-top: 20px;
                border-top: 1px solid rgba(244, 164, 96, 0.3);
                position: relative;
                z-index: 2;
            }
            
            .save-status
            {
                font-size: 12px;
                color: #daa520;
                font-style: italic;
            }
            
            .last-saved
            {
                font-size: 11px;
                color: #cd853f;
                opacity: 0.6;
                margin-top: 5px;
            }
        }
        
        script
        {
            // 按CHTL语法文档：使用虚对象和增强选择器管理暖色笔记
            vir warmNoteController = iNeverAway({
                Save: function() {
                    const content = {{.note-textarea}}.value;
                    const timestamp = new Date().toLocaleString('zh-CN');
                    
                    // 保存到本地存储
                    localStorage.setItem('chtholly_warm_note', content);
                    localStorage.setItem('chtholly_warm_note_time', timestamp);
                    
                    {{.save-status}}.textContent = '已保存';
                    {{.last-saved}}.textContent = '最后保存: ' + timestamp;
                    
                    console.log('🌸 珂朵莉的暖色笔记已保存');
                    
                    // 显示保存动画
                    this.showSaveAnimation();
                },
                
                Load: function() {
                    const saved = localStorage.getItem('chtholly_warm_note');
                    const savedTime = localStorage.getItem('chtholly_warm_note_time');
                    
                    if (saved) {
                        {{.note-textarea}}.value = saved;
                        if (savedTime) {
                            {{.last-saved}}.textContent = '最后保存: ' + savedTime;
                        }
                        console.log('🌸 珂朵莉的暖色笔记已加载');
                    }
                },
                
                Clear: function() {
                    if (confirm('确定要清空珂朵莉的暖色笔记吗？这些美好的回忆将会消失...')) {
                        {{.note-textarea}}.value = '';
                        localStorage.removeItem('chtholly_warm_note');
                        localStorage.removeItem('chtholly_warm_note_time');
                        {{.save-status}}.textContent = '已清空';
                        {{.last-saved}}.textContent = '';
                        console.log('🌸 珂朵莉的暖色笔记已清空');
                    }
                },
                
                Export: function() {
                    const content = {{.note-textarea}}.value;
                    if (!content.trim()) {
                        alert('笔记内容为空，无法导出');
                        return;
                    }
                    
                    const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = '珂朵莉的暖色笔记_' + new Date().toISOString().slice(0, 10) + '.txt';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    console.log('🌸 珂朵莉的暖色笔记已导出');
                },
                
                updateStats: function() {
                    const content = {{.note-textarea}}.value;
                    const wordCount = content.trim().split(/\s+/).filter(word => word.length > 0).length;
                    const charCount = content.length;
                    const lineCount = content.split('\n').length;
                    
                    {{.word-count}}.textContent = wordCount;
                    {{.char-count}}.textContent = charCount;
                    {{.line-count}}.textContent = lineCount;
                },
                
                showSaveAnimation: function() {
                    {{.save-status}}.style.animation = 'saveGlow 1s ease-out';
                    setTimeout(() => {
                        {{.save-status}}.style.animation = '';
                    }, 1000);
                }
            });
            
            // 自动保存功能
            let autoSaveTimer;
            {{.note-textarea}}->listen({
                input: function() {
                    warmNoteController->updateStats();
                    {{.save-status}}.textContent = '未保存';
                    
                    // 防抖自动保存
                    clearTimeout(autoSaveTimer);
                    autoSaveTimer = setTimeout(() => {
                        warmNoteController->Save();
                    }, 2000);
                }
            });
            
            // 工具栏按钮事件
            {{.save-btn}}->listen({
                click: function() {
                    warmNoteController->Save();
                }
            });
            
            {{.load-btn}}->listen({
                click: function() {
                    warmNoteController->Load();
                }
            });
            
            {{.clear-btn}}->listen({
                click: function() {
                    warmNoteController->Clear();
                }
            });
            
            {{.export-btn}}->listen({
                click: function() {
                    warmNoteController->Export();
                }
            });
            
            // 快捷键支持
            {{.note-textarea}}->listen({
                keydown: function(event) {
                    if (event.ctrlKey || event.metaKey) {
                        if (event.key === 's') {
                            event.preventDefault();
                            warmNoteController->Save();
                        } else if (event.key === 'o') {
                            event.preventDefault();
                            warmNoteController->Load();
                        }
                    }
                }
            });
            
            // 初始化
            {{document}}->listen({
                DOMContentLoaded: function() {
                    warmNoteController->Load();
                    warmNoteController->updateStats();
                    {{.note-textarea}}.focus();
                    
                    console.log('🌸 珂朵莉的暖色笔记已准备就绪，记录美好的回忆吧...');
                }
            });
        }
        
        div
        {
            class: "note-header";
            
            h2
            {
                class: "note-title";
                text { "珂朵莉的暖色笔记" }
            }
            
            p
            {
                class: "note-subtitle";
                text { "记录最珍贵的时光，温暖如阳光般的回忆" }
            }
        }
        
        div
        {
            class: "note-toolbar";
            
            div
            {
                class: "toolbar-group";
                
                button
                {
                    class: "toolbar-btn save-btn";
                    text { "保存" }
                }
                
                button
                {
                    class: "toolbar-btn load-btn";
                    text { "加载" }
                }
                
                button
                {
                    class: "toolbar-btn export-btn";
                    text { "导出" }
                }
                
                button
                {
                    class: "toolbar-btn clear-btn";
                    text { "清空" }
                }
            }
            
            div
            {
                class: "note-stats";
                
                div
                {
                    class: "stat-item";
                    text { "字数: " }
                    span
                    {
                        class: "word-count";
                        text { "0" }
                    }
                }
                
                div
                {
                    class: "stat-item";
                    text { "字符: " }
                    span
                    {
                        class: "char-count";
                        text { "0" }
                    }
                }
                
                div
                {
                    class: "stat-item";
                    text { "行数: " }
                    span
                    {
                        class: "line-count";
                        text { "1" }
                    }
                }
            }
        }
        
        div
        {
            class: "note-editor";
            
            textarea
            {
                class: "note-textarea";
                placeholder: "在这里记录珂朵莉最美好的回忆...

就像那个春天的午后，阳光透过樱花树洒在她的脸上，
她笑得那么灿烂，那么纯真...

这些温暖的时光，值得被永远珍藏。";
            }
        }
        
        div
        {
            class: "note-footer";
            
            div
            {
                class: "save-status";
                text { "准备就绪" }
            }
            
            div
            {
                class: "last-saved";
                text { "" }
            }
        }
    }
}

// 按CHTL语法文档：定义相关的自定义样式组和变量组
[Custom] @Style ChthollyWarmNoteStyle
{
    warm-background,
    warm-border,
    warm-text-color;
    
    border-radius: 20px;
    font-family: "Georgia", serif;
    box-shadow: 0 10px 30px rgba(255, 218, 185, 0.3);
    transition: all 0.3s ease;
}

[Custom] @Var ChthollyWarmTheme
{
    warmBackground: "linear-gradient(135deg, #fff8dc 0%, #ffefd5 50%, #ffe4e1 100%)";
    warmBorder: "#ffd4a3";
    warmText: "#d2691e";
    warmAccent: "#cd853f";
    warmGlow: "rgba(255, 218, 185, 0.3)";
}