// ========================================
// 由比滨结衣CMOD主模块 - 严格按照CHTL语法文档
// 7个UI组件的完整实现 - 温暖阳光风格
// ========================================

// 由比滨结衣主题色彩变量组
[Custom] @Var YuigahamaColorPalette
{
    primaryColor: "#FFE4B5";     // 鹿皮色 - 由比滨的温暖
    secondaryColor: "#FFEFD5";   // 纸白色 - 由比滨的纯真
    accentColor: "#FF7F50";      // 珊瑚色 - 由比滨的活力
    backgroundColor: "#FFF8DC";   // 玉米丝色 - 温暖背景
    textColor: "#8B4513";        // 马鞍棕色 - 温暖文字
    borderColor: "#DEB887";      // 硬木色 - 自然边框
    shadowColor: "#F5DEB3";      // 小麦色 - 柔和阴影
}

[Custom] @Var YuigahamaSpacing
{
    xs: "4px";
    sm: "8px";
    md: "16px";
    lg: "24px";
    xl: "32px";
    xxl: "48px";
}

[Custom] @Var YuigahamaFonts
{
    primaryFont: "'Hiragino Sans GB', 'Microsoft YaHei', sans-serif";
    headingFont: "'Georgia', 'Times New Roman', serif";
    codeFont: "'Consolas', 'Monaco', monospace";
}

// 1. 音乐播放器组件
[Custom] @Element YuigahamaMusicPlayer
{
    div
    {
        class: "yuigahama-music-player";
        
        style
        {
            .yuigahama-music-player
            {
                background: linear-gradient(135deg, YuigahamaColorPalette(primaryColor), YuigahamaColorPalette(secondaryColor));
                border-radius: 20px;
                padding: YuigahamaSpacing(lg);
                box-shadow: 0 8px 32px YuigahamaColorPalette(shadowColor);
                font-family: YuigahamaFonts(primaryFont);
                max-width: 400px;
                position: relative;
                overflow: hidden;
            }
            
            .yuigahama-music-player::before
            {
                content: "";
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="20" cy="20" r="2" fill="%23FF7F50" opacity="0.3"/><circle cx="80" cy="30" r="1.5" fill="%23FFE4B5" opacity="0.4"/><circle cx="60" cy="70" r="1" fill="%23FF7F50" opacity="0.2"/></svg>');
                pointer-events: none;
            }
            
            .music-cover
            {
                width: 120px;
                height: 120px;
                border-radius: 50%;
                margin: 0 auto YuigahamaSpacing(md);
                background: linear-gradient(45deg, YuigahamaColorPalette(accentColor), YuigahamaColorPalette(primaryColor));
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 3em;
                color: white;
                animation: musicRotate 10s linear infinite paused;
                box-shadow: 0 4px 16px YuigahamaColorPalette(shadowColor);
            }
            
            @keyframes musicRotate
            {
                from { transform: rotate(0deg); }
                to { transform: rotate(360deg); }
            }
            
            .music-cover.playing
            {
                animation-play-state: running;
            }
            
            .music-info
            {
                text-align: center;
                margin-bottom: YuigahamaSpacing(md);
            }
            
            .music-title
            {
                font-size: 1.3em;
                font-weight: 700;
                color: YuigahamaColorPalette(textColor);
                margin-bottom: YuigahamaSpacing(xs);
            }
            
            .music-artist
            {
                font-size: 1em;
                color: YuigahamaColorPalette(accentColor);
                opacity: 0.8;
            }
            
            .music-progress
            {
                background: YuigahamaColorPalette(borderColor);
                height: 6px;
                border-radius: 3px;
                margin: YuigahamaSpacing(md) 0;
                overflow: hidden;
            }
            
            .progress-bar
            {
                background: linear-gradient(90deg, YuigahamaColorPalette(accentColor), YuigahamaColorPalette(primaryColor));
                height: 100%;
                width: 0%;
                transition: width 0.3s ease;
                border-radius: 3px;
            }
            
            .music-controls
            {
                display: flex;
                justify-content: center;
                align-items: center;
                gap: YuigahamaSpacing(md);
            }
            
            .control-btn
            {
                width: 50px;
                height: 50px;
                border-radius: 50%;
                border: none;
                background: YuigahamaColorPalette(accentColor);
                color: white;
                font-size: 1.2em;
                cursor: pointer;
                transition: all 0.3s ease;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            .control-btn:hover
            {
                transform: scale(1.1);
                box-shadow: 0 4px 12px YuigahamaColorPalette(accentColor);
            }
            
            .play-btn
            {
                width: 60px;
                height: 60px;
                font-size: 1.5em;
            }
        }
        
        script
        {
            let isPlaying = false;
            let progress = 0;
            let progressInterval = null;
            
            const cover = {{.music-cover}};
            const progressBar = {{.progress-bar}};
            const playBtn = {{.play-btn}};
            
            function togglePlay() {
                isPlaying = !isPlaying;
                
                if (isPlaying) {
                    cover.classList.add('playing');
                    playBtn.textContent = '⏸️';
                    startProgress();
                    console.log('🎵 由比滨的音乐开始播放');
                } else {
                    cover.classList.remove('playing');
                    playBtn.textContent = '▶️';
                    stopProgress();
                    console.log('⏸️ 由比滨的音乐暂停');
                }
            }
            
            function startProgress() {
                progressInterval = setInterval(() => {
                    progress += 0.5;
                    if (progress > 100) {
                        progress = 0;
                        togglePlay(); // 自动停止
                    }
                    progressBar.style.width = progress + '%';
                }, 100);
            }
            
            function stopProgress() {
                if (progressInterval) {
                    clearInterval(progressInterval);
                    progressInterval = null;
                }
            }
            
            {{.yuigahama-music-player}}->listen({
                click: function(event) {
                    if (event.target.classList.contains('play-btn') || 
                        event.target.closest('.play-btn')) {
                        togglePlay();
                    } else if (event.target.classList.contains('control-btn')) {
                        const btn = event.target;
                        if (btn.textContent === '⏮️') {
                            progress = 0;
                            progressBar.style.width = '0%';
                            console.log('⏮️ 由比滨音乐重新开始');
                        } else if (btn.textContent === '⏭️') {
                            progress = 100;
                            progressBar.style.width = '100%';
                            console.log('⏭️ 由比滨音乐跳到结尾');
                        }
                    }
                }
            });
        }
    }
    
    div
    {
        class: "music-cover";
        text { 🎵 }
    }
    
    div
    {
        class: "music-info";
        
        div
        {
            class: "music-title";
            text { 由比滨结衣的温暖旋律 }
        }
        
        div
        {
            class: "music-artist";
            text { Yuigahama Yui }
        }
    }
    
    div
    {
        class: "music-progress";
        
        div
        {
            class: "progress-bar";
        }
    }
    
    div
    {
        class: "music-controls";
        
        button
        {
            class: "control-btn";
            text { ⏮️ }
        }
        
        button
        {
            class: "control-btn play-btn";
            text { ▶️ }
        }
        
        button
        {
            class: "control-btn";
            text { ⏭️ }
        }
    }
}

// 2. 手风琴组件 (由比滨风格)
[Custom] @Element YuigahamaAccordion
{
    div
    {
        class: "yuigahama-accordion";
        
        style
        {
            .yuigahama-accordion
            {
                background: YuigahamaColorPalette(backgroundColor);
                border-radius: 16px;
                overflow: hidden;
                box-shadow: 0 6px 20px YuigahamaColorPalette(shadowColor);
                font-family: YuigahamaFonts(primaryFont);
                border: 2px solid YuigahamaColorPalette(borderColor);
            }
            
            .accordion-item
            {
                border-bottom: 1px solid YuigahamaColorPalette(borderColor);
            }
            
            .accordion-item:last-child
            {
                border-bottom: none;
            }
            
            .accordion-header
            {
                background: linear-gradient(135deg, YuigahamaColorPalette(primaryColor), YuigahamaColorPalette(secondaryColor));
                padding: YuigahamaSpacing(lg);
                cursor: pointer;
                transition: all 0.3s ease;
                color: YuigahamaColorPalette(textColor);
                font-weight: 600;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
            
            .accordion-header:hover
            {
                background: linear-gradient(135deg, YuigahamaColorPalette(accentColor), YuigahamaColorPalette(primaryColor));
                transform: translateX(4px);
            }
            
            .accordion-icon
            {
                transition: transform 0.3s ease;
                font-size: 1.2em;
            }
            
            .accordion-header.active .accordion-icon
            {
                transform: rotate(180deg);
            }
            
            .accordion-content
            {
                max-height: 0;
                overflow: hidden;
                transition: max-height 0.4s ease;
                background: YuigahamaColorPalette(backgroundColor);
            }
            
            .accordion-content.active
            {
                max-height: 300px;
            }
            
            .accordion-body
            {
                padding: YuigahamaSpacing(lg);
                color: YuigahamaColorPalette(textColor);
                line-height: 1.7;
                background: linear-gradient(to right, transparent, YuigahamaColorPalette(primaryColor), transparent);
                background-size: 100% 2px;
                background-position: 0 0;
                background-repeat: no-repeat;
            }
        }
        
        script
        {
            {{.yuigahama-accordion}}->listen({
                click: function(event) {
                    const header = event.target.closest('.accordion-header');
                    if (header) {
                        const content = header.nextElementSibling;
                        const isActive = content.classList.contains('active');
                        
                        // 关闭所有其他项
                        {{.accordion-content}}.forEach(item => {
                            item.classList.remove('active');
                            item.previousElementSibling.classList.remove('active');
                        });
                        
                        // 切换当前项
                        if (!isActive) {
                            content.classList.add('active');
                            header.classList.add('active');
                        }
                        
                        console.log('🌸 由比滨手风琴展开/收起');
                    }
                }
            });
        }
    }
    
    div
    {
        class: "accordion-item";
        
        div
        {
            class: "accordion-header";
            
            text { 由比滨的温暖回忆 }
            
            span
            {
                class: "accordion-icon";
                text { 🌻 }
            }
        }
        
        div
        {
            class: "accordion-content";
            
            div
            {
                class: "accordion-body";
                text { 这里是由比滨结衣温暖阳光般的美好回忆，充满了青春的活力和真挚的友情... }
            }
        }
    }
}

// 3. 四叶窗相册组件 (由比滨风格)
[Custom] @Element YuigahamaGallery
{
    div
    {
        class: "yuigahama-gallery";
        
        style
        {
            .yuigahama-gallery
            {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
                gap: YuigahamaSpacing(lg);
                padding: YuigahamaSpacing(xl);
                background: linear-gradient(45deg, YuigahamaColorPalette(backgroundColor), YuigahamaColorPalette(secondaryColor));
                border-radius: 20px;
                position: relative;
            }
            
            .yuigahama-gallery::before
            {
                content: "";
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: radial-gradient(circle at 30% 70%, YuigahamaColorPalette(primaryColor) 0%, transparent 50%),
                           radial-gradient(circle at 70% 30%, YuigahamaColorPalette(accentColor) 0%, transparent 50%);
                opacity: 0.3;
                pointer-events: none;
            }
            
            .gallery-item
            {
                position: relative;
                overflow: hidden;
                border-radius: 16px;
                box-shadow: 0 8px 24px YuigahamaColorPalette(shadowColor);
                transition: transform 0.3s ease;
                background: white;
                z-index: 1;
            }
            
            .gallery-item:hover
            {
                transform: translateY(-12px) scale(1.03);
                box-shadow: 0 16px 40px YuigahamaColorPalette(accentColor);
            }
            
            .gallery-image
            {
                width: 100%;
                height: 220px;
                background: linear-gradient(135deg, YuigahamaColorPalette(primaryColor), YuigahamaColorPalette(accentColor));
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 3em;
                color: white;
                transition: transform 0.3s ease;
            }
            
            .gallery-item:hover .gallery-image
            {
                transform: scale(1.1);
            }
            
            .gallery-overlay
            {
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: linear-gradient(to bottom, transparent 60%, YuigahamaColorPalette(accentColor));
                opacity: 0;
                transition: opacity 0.3s ease;
                display: flex;
                align-items: flex-end;
                padding: YuigahamaSpacing(md);
                color: white;
                font-weight: 600;
            }
            
            .gallery-item:hover .gallery-overlay
            {
                opacity: 0.9;
            }
            
            .gallery-caption
            {
                background: YuigahamaColorPalette(backgroundColor);
                padding: YuigahamaSpacing(md);
                color: YuigahamaColorPalette(textColor);
                font-weight: 600;
                text-align: center;
            }
        }
        
        script
        {
            {{.yuigahama-gallery}}->listen({
                click: function(event) {
                    const item = event.target.closest('.gallery-item');
                    if (item) {
                        console.log('🌻 由比滨相册图片点击');
                        
                        // 创建温暖的点击效果
                        const ripple = document.createElement('div');
                        ripple.style.cssText = `
                            position: absolute;
                            border-radius: 50%;
                            background: ${YuigahamaColorPalette(accentColor)};
                            transform: scale(0);
                            animation: yuigahamaRipple 0.8s ease-out;
                            opacity: 0.6;
                            pointer-events: none;
                            width: 120px;
                            height: 120px;
                            left: 50%;
                            top: 50%;
                            margin-left: -60px;
                            margin-top: -60px;
                        `;
                        
                        item.appendChild(ripple);
                        
                        setTimeout(() => {
                            ripple.remove();
                        }, 800);
                    }
                }
            });
            
            // 添加CSS动画
            const style = document.createElement('style');
            style.textContent = `
                @keyframes yuigahamaRipple {
                    0% { transform: scale(0); opacity: 0.6; }
                    50% { transform: scale(1.2); opacity: 0.4; }
                    100% { transform: scale(2); opacity: 0; }
                }
            `;
            document.head.appendChild(style);
        }
    }
    
    div
    {
        class: "gallery-item";
        
        div
        {
            class: "gallery-image";
            text { 🌻 }
        }
        
        div
        {
            class: "gallery-overlay";
            text { 由比滨的阳光时光 }
        }
        
        div
        {
            class: "gallery-caption";
            text { 温暖的午后阳光 }
        }
    }
    
    div
    {
        class: "gallery-item";
        
        div
        {
            class: "gallery-image";
            text { 🌞 }
        }
        
        div
        {
            class: "gallery-overlay";
            text { 青春的美好回忆 }
        }
        
        div
        {
            class: "gallery-caption";
            text { 友情的珍贵瞬间 }
        }
    }
}

// 4. 备忘录组件 (由比滨风格)
[Custom] @Element YuigahamaMemo
{
    div
    {
        class: "yuigahama-memo";
        
        style
        {
            .yuigahama-memo
            {
                background: YuigahamaColorPalette(backgroundColor);
                border: 3px solid YuigahamaColorPalette(primaryColor);
                border-radius: 20px;
                padding: YuigahamaSpacing(xl);
                box-shadow: 0 10px 30px YuigahamaColorPalette(shadowColor);
                font-family: YuigahamaFonts(primaryFont);
                position: relative;
                overflow: hidden;
                max-width: 400px;
            }
            
            .yuigahama-memo::before
            {
                content: "";
                position: absolute;
                top: -10px;
                right: -10px;
                width: 80px;
                height: 80px;
                background: YuigahamaColorPalette(accentColor);
                border-radius: 50%;
                opacity: 0.1;
                animation: yuigahamaPulse 3s ease-in-out infinite;
            }
            
            @keyframes yuigahamaPulse
            {
                0%, 100% { transform: scale(1); opacity: 0.1; }
                50% { transform: scale(1.2); opacity: 0.2; }
            }
            
            .memo-header
            {
                display: flex;
                align-items: center;
                gap: YuigahamaSpacing(sm);
                margin-bottom: YuigahamaSpacing(lg);
                color: YuigahamaColorPalette(accentColor);
                font-weight: 700;
                font-size: 1.3em;
            }
            
            .memo-icon
            {
                width: 32px;
                height: 32px;
                background: linear-gradient(135deg, YuigahamaColorPalette(accentColor), YuigahamaColorPalette(primaryColor));
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                color: white;
                font-size: 1em;
                box-shadow: 0 4px 12px YuigahamaColorPalette(shadowColor);
            }
            
            .memo-content
            {
                color: YuigahamaColorPalette(textColor);
                line-height: 1.8;
                font-size: 1.1em;
                margin-bottom: YuigahamaSpacing(lg);
            }
            
            .memo-footer
            {
                margin-top: YuigahamaSpacing(md);
                padding-top: YuigahamaSpacing(md);
                border-top: 2px solid YuigahamaColorPalette(borderColor);
                font-size: 0.95em;
                color: YuigahamaColorPalette(accentColor);
                text-align: right;
                font-style: italic;
            }
            
            .memo-decorations
            {
                position: absolute;
                bottom: 20px;
                left: 20px;
                font-size: 1.5em;
                opacity: 0.3;
                color: YuigahamaColorPalette(accentColor);
            }
        }
        
        script
        {
            {{.yuigahama-memo}}->listen({
                mouseenter: function() {
                    animate({
                        target: this,
                        duration: 300,
                        begin: { transform: 'scale(1) rotate(0deg)' },
                        end: { transform: 'scale(1.03) rotate(1deg)' }
                    });
                    console.log('🌻 由比滨备忘录获得关注');
                },
                
                mouseleave: function() {
                    animate({
                        target: this,
                        duration: 300,
                        begin: { transform: 'scale(1.03) rotate(1deg)' },
                        end: { transform: 'scale(1) rotate(0deg)' }
                    });
                }
            });
        }
    }
    
    div
    {
        class: "memo-header";
        
        div
        {
            class: "memo-icon";
            text { 🌻 }
        }
        
        text { 由比滨的温暖备忘录 }
    }
    
    div
    {
        class: "memo-content";
        text { 记录下每一个温暖的瞬间，就像阳光一样，由比滨结衣总是能够带给身边的人无尽的温暖和快乐... }
    }
    
    div
    {
        class: "memo-footer";
        text { —— 来自由比滨结衣的阳光温暖 }
    }
    
    div
    {
        class: "memo-decorations";
        text { 🌞✨🌻 }
    }
}