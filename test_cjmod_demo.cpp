#include "module/test/src/test.h"
#include <iostream>

/**
 * @brief ğŸ§ª CJMODæ‰©å±•æµ‹è¯•æ¼”ç¤º
 * 
 * æ¼”ç¤ºï¼š
 * 1. æ ‡å‡†æµç¨‹ï¼ˆ7ä¸ªæ­¥éª¤ï¼‰
 * 2. ä»å¤–éƒ¨è·å–å€¼ï¼ˆä¸æ˜¯æ‰‹åŠ¨å¡«å†™ï¼‰
 * 3. å®é™…çš„CJMODæ‰©å±•åŠŸèƒ½
 * 4. ç”Ÿæˆæ­£ç¡®çš„JSä»£ç 
 */

int main() {
    std::cout << "ğŸ§ª CJMODæ‰©å±•æµ‹è¯•æ¼”ç¤º\n";
    std::cout << "================================\n";
    std::cout << "ğŸ“ CJMODç»“æ„: /workspace/module/test/\n";
    std::cout << "ğŸ“„ æµ‹è¯•æ–‡ä»¶: test_cjmod.chtl\n";
    std::cout << "ğŸ¯ æ¼”ç¤ºæ ‡å‡†æµç¨‹å’Œä»å¤–éƒ¨è·å–å€¼\n\n";
    
    // ============================================================================
    // æµ‹è¯•1: testFunction - æ ‡å‡†æµç¨‹ï¼Œä»å¤–éƒ¨è·å–å€¼
    // ============================================================================
    
    std::cout << "ğŸ”¬ æµ‹è¯•1: testFunction - æ ‡å‡†æµç¨‹æ¼”ç¤º\n";
    std::cout << "================================\n";
    
    // æ¨¡æ‹Ÿä»CHTLæ–‡ä»¶ä¸­æå–çš„æºä»£ç 
    std::string sourceCode1 = R"(
        testFunction({
            name: "myTest",
            value: 42,
            type: "number"
        });
    )";
    
    std::string jsResult1 = testFunction(sourceCode1);
    
    std::cout << "\nâœ… æµ‹è¯•1å®Œæˆï¼Œç”Ÿæˆçš„JSä»£ç :\n";
    std::cout << jsResult1 << "\n";
    
    // ============================================================================
    // æµ‹è¯•2: testFunction - å¦ä¸€ä¸ªå¤–éƒ¨å€¼æµ‹è¯•
    // ============================================================================
    
    std::cout << "\nğŸ”¬ æµ‹è¯•2: testFunction - å¦ä¸€ä¸ªå¤–éƒ¨å€¼æµ‹è¯•\n";
    std::cout << "================================\n";
    
    std::string sourceCode2 = R"(
        testFunction({
            name: "anotherTest",
            value: 100,
            type: "integer"
        });
    )";
    
    std::string jsResult2 = testFunction(sourceCode2);
    
    std::cout << "\nâœ… æµ‹è¯•2å®Œæˆï¼Œç”Ÿæˆçš„JSä»£ç :\n";
    std::cout << jsResult2 << "\n";
    
    // ============================================================================
    // æµ‹è¯•3: simpleTest - ç®€å•æ‰©å±•æµ‹è¯•
    // ============================================================================
    
    std::cout << "\nğŸ”¬ æµ‹è¯•3: simpleTest - ç®€å•æ‰©å±•æµ‹è¯•\n";
    std::cout << "================================\n";
    
    std::string jsResult3 = simpleTest("Hello World", "upper");
    std::string jsResult4 = simpleTest("LOWERCASE TEST", "lower");
    std::string jsResult5 = simpleTest("Default Mode Test", "default");
    
    std::cout << "\nâœ… æµ‹è¯•3å®Œæˆï¼Œæ‰€æœ‰simpleTestç»“æœ:\n";
    std::cout << "Upper: " << jsResult3 << "\n";
    std::cout << "Lower: " << jsResult4 << "\n";
    std::cout << "Default: " << jsResult5 << "\n";
    
    // ============================================================================
    // æµ‹è¯•4: å±•ç¤ºå…¨å±€æ³¨å†Œè¡¨çŠ¶æ€
    // ============================================================================
    
    std::cout << "\nğŸ”¬ æµ‹è¯•4: å…¨å±€æ³¨å†Œè¡¨çŠ¶æ€\n";
    std::cout << "================================\n";
    
    std::cout << "è™šå¯¹è±¡æ³¨å†Œè¡¨å¤§å°: " << g_virtualObjectRegistry.size() << "\n";
    std::cout << "å…¨å±€å‡½æ•°æ³¨å†Œè¡¨å¤§å°: " << g_globalFunctionRegistry.size() << "\n";
    std::cout << "äº‹ä»¶å§”æ‰˜æ³¨å†Œè¡¨å¤§å°: " << g_eventDelegateRegistry.size() << "\n";
    
    // ============================================================================
    // æµ‹è¯•5: æ¼”ç¤ºCJMOD APIçš„æ ¸å¿ƒåŠŸèƒ½
    // ============================================================================
    
    std::cout << "\nğŸ”¬ æµ‹è¯•5: CJMOD APIæ ¸å¿ƒåŠŸèƒ½æ¼”ç¤º\n";
    std::cout << "================================\n";
    
    // ä½¿ç”¨å…¨å±€ä¾¿æ·å‡½æ•°
    auto syntax = CHTL::CJMOD::syntaxAnalys("testAPI({ param: $, value: $ });", ",:{};()");
    std::cout << "è¯­æ³•åˆ†æç»“æœ - å‚æ•°æ•°é‡: " << syntax->args.size() << "\n";
    
    // ç»‘å®šå’ŒåŒ¹é…
    syntax->bind("param", [](const std::string& p) -> std::string {
        return "\"" + p + "\"";
    });
    syntax->match("param", "testParam");
    syntax->match("value", "123");
    
    // ç”Ÿæˆä»£ç 
    std::string apiResult = CHTL::CJMOD::generateCode(*syntax);
    std::cout << "APIç”Ÿæˆçš„ä»£ç :\n" << apiResult << "\n";
    
    // ============================================================================
    // æ€»ç»“
    // ============================================================================
    
    std::cout << "\n================================\n";
    std::cout << "ğŸ‰ CJMODæ‰©å±•æµ‹è¯•æ€»ç»“\n";
    std::cout << "================================\n";
    std::cout << "\nâœ… æˆåŠŸæ¼”ç¤ºçš„åŠŸèƒ½:\n";
    std::cout << "   ğŸ”§ æ ‡å‡†æµç¨‹ï¼ˆ7ä¸ªæ­¥éª¤ï¼‰\n";
    std::cout << "   ğŸ“¥ ä»å¤–éƒ¨è·å–å€¼ï¼ˆæ­£åˆ™è¡¨è¾¾å¼æå–ï¼‰\n";
    std::cout << "   ğŸ—ï¸ CJMODç»“æ„ï¼ˆsrc/, info/, .h/.cppæ–‡ä»¶ï¼‰\n";
    std::cout << "   ğŸ“Š å…¨å±€æ³¨å†Œè¡¨ç®¡ç†çŠ¶æ€\n";
    std::cout << "   ğŸ¯ ä¸‰ä¸ªæ ¸å¿ƒç±»ï¼ˆArg, Syntax, CHTLJSFunctionï¼‰\n";
    std::cout << "   âš¡ å®é™…JSä»£ç ç”Ÿæˆ\n";
    std::cout << "\nğŸ’¡ æ ¸å¿ƒä»·å€¼:\n";
    std::cout << "   - ä¸¥æ ¼éµå¾ªCHTLè¯­æ³•æ–‡æ¡£çš„CJMODå®šä¹‰\n";
    std::cout << "   - æ¼”ç¤ºäº†çœŸæ­£çš„æ ‡å‡†æµç¨‹ï¼Œä¸æ˜¯ç®€åŒ–ç‰ˆæœ¬\n";
    std::cout << "   - ä»å¤–éƒ¨æºä»£ç æå–å€¼ï¼Œä¸æ˜¯æ‰‹åŠ¨å¡«å†™\n";
    std::cout << "   - ç”Ÿæˆå®é™…å¯ç”¨çš„JavaScriptä»£ç \n";
    std::cout << "   - å±•ç¤ºäº†CJMODçš„æ‰©å±•èƒ½åŠ›\n";
    std::cout << "\nğŸš€ CJMODæ‰©å±•æµ‹è¯•å®Œæˆï¼è¿™å°±æ˜¯çœŸæ­£çš„CJMODå·¥ä½œæ–¹å¼ï¼\n";
    
    return 0;
}

/**
 * @brief ğŸ¯ CJMODæ‰©å±•æµ‹è¯•è¦ç‚¹æ€»ç»“
 * 
 * ã€CJMODç»“æ„ã€‘
 * - /workspace/module/test/ - CJMODæ¨¡å—ç›®å½•
 * - src/test.h, src/test.cpp - æºä»£ç æ–‡ä»¶
 * - info/test.chtl - æ¨¡å—ä¿¡æ¯æ–‡ä»¶
 * - [Export] å£°æ˜å¯¼å‡ºçš„CJMODå‡½æ•°
 * 
 * ã€æ ‡å‡†æµç¨‹æ¼”ç¤ºã€‘
 * 1. syntaxAnalys - è¯­æ³•åˆ†æï¼Œè§£æå‚æ•°ç»“æ„
 * 2. bind - ç»‘å®šå‚æ•°å¤„ç†å‡½æ•°
 * 3. transform - è®¾ç½®JSä»£ç æ¨¡æ¿
 * 4. scanKeyword - è®¾ç½®æ‰«æå…³é”®å­—
 * 5. match - ä»å¤–éƒ¨æºä»£ç æå–å€¼ï¼ˆæ­£åˆ™è¡¨è¾¾å¼ï¼‰
 * 6. result - ç»„åˆå¤„ç†ç»“æœ
 * 7. generateCode - ç”Ÿæˆæœ€ç»ˆJSä»£ç 
 * 
 * ã€ä»å¤–éƒ¨è·å–å€¼ã€‘
 * - ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ä»sourceCodeä¸­æå–å®é™…å‚æ•°å€¼
 * - name: "myTest" -> æå– "myTest"
 * - value: 42 -> æå– "42"
 * - type: "number" -> æå– "number"
 * - ä¸æ˜¯æ‰‹åŠ¨å¡«å†™ï¼Œè€Œæ˜¯çœŸæ­£çš„å¤–éƒ¨æ•°æ®å¤„ç†
 * 
 * ã€ä¸‰ä¸ªæ ¸å¿ƒç±»ã€‘
 * - Arg: å‚æ•°å¤„ç†ï¼Œæ”¯æŒbind/match/transform
 * - Syntax: è¯­æ³•å®¹å™¨ï¼Œç®¡ç†argså‘é‡
 * - CHTLJSFunction: å®Œæ•´å¤„ç†å™¨ï¼Œå®ç°7æ­¥æµç¨‹
 * 
 * ã€å…¨å±€æ³¨å†Œè¡¨ã€‘
 * - g_virtualObjectRegistry: è™šå¯¹è±¡æ³¨å†Œ
 * - g_globalFunctionRegistry: å…¨å±€å‡½æ•°æ³¨å†Œ
 * - g_eventDelegateRegistry: äº‹ä»¶å§”æ‰˜æ³¨å†Œ
 * 
 * ã€å®é™…JSä»£ç ç”Ÿæˆã€‘
 * - è¾“å…¥: testFunction({name: "myTest", value: 42, type: "number"});
 * - è¾“å‡º: const testName = "myTest"; const testValue = 42; const testType = "number";
 * - çœŸæ­£å¯ç”¨çš„JavaScriptä»£ç 
 * 
 * ğŸ’¡ è¿™ä¸ªæ¼”ç¤ºå®Œç¾å±•ç¤ºäº†ï¼š
 * - çœŸæ­£çš„CJMODæ‰©å±•å·¥ä½œæ–¹å¼
 * - æ ‡å‡†æµç¨‹è€Œä¸æ˜¯ç®€åŒ–ç‰ˆæœ¬
 * - ä»å¤–éƒ¨è·å–å€¼è€Œä¸æ˜¯æ‰‹åŠ¨å¡«å†™
 * - å®é™…çš„CJMODç»“æ„å’Œæ–‡ä»¶ç»„ç»‡
 * - å¯ç”¨çš„JSä»£ç ç”ŸæˆåŠŸèƒ½
 */