// ============================================================================
// CHTLé”™è¯¯å¤„ç†æµ‹è¯•ç”¨ä¾‹
// æµ‹è¯•å„ç§é”™è¯¯æƒ…å†µå’Œè¾¹ç•Œæ¡ä»¶
// ============================================================================

// ============================================================================
// 1. è¯­æ³•é”™è¯¯æµ‹è¯•ç”¨ä¾‹ï¼ˆè¿™äº›åº”è¯¥è¢«ç¼–è¯‘å™¨æ•è·ï¼‰
// ============================================================================

// æ³¨æ„ï¼šä»¥ä¸‹æ˜¯é”™è¯¯è¯­æ³•ç¤ºä¾‹ï¼Œç”¨äºæµ‹è¯•ç¼–è¯‘å™¨çš„é”™è¯¯æ£€æµ‹èƒ½åŠ›
// åœ¨å®é™…ç¼–è¯‘æ—¶è¿™äº›åº”è¯¥äº§ç”Ÿé”™è¯¯

/*
// é”™è¯¯æ¡ˆä¾‹1ï¼šä¸æ­£ç¡®çš„æ³¨é‡ŠåµŒå¥—
/* å¤–å±‚æ³¨é‡Š
   // å†…å±‚å•è¡Œæ³¨é‡Š
   /* å†…å±‚å¤šè¡Œæ³¨é‡Š - è¿™ä¼šå¯¼è‡´æ³¨é‡ŠåµŒå¥—é”™è¯¯ */
*/
*/

/*
// é”™è¯¯æ¡ˆä¾‹2ï¼šCEå¯¹ç­‰å¼æ··ç”¨é”™è¯¯
div {
    class: container = main;  // é”™è¯¯ï¼šä¸èƒ½åŒæ—¶ä½¿ç”¨å†’å·å’Œç­‰å·
}
*/

/*
// é”™è¯¯æ¡ˆä¾‹3ï¼šä¸æ”¯æŒçš„é“¾å¼æ“ä½œ
[Template] @Style MultiInherit {
    inherit @Style Style1, @Style Style2;  // é”™è¯¯ï¼šinheritä¸æ”¯æŒé“¾å¼
}
*/

/*
// é”™è¯¯æ¡ˆä¾‹4ï¼šexceptçº¦æŸé”™è¯¯ç±»å‹
div {
    except @JavaScript, @Style;  // é”™è¯¯ï¼šexceptåªèƒ½çº¦æŸ@Html, [Custom], [Template]
}
*/

/*
// é”™è¯¯æ¡ˆä¾‹5ï¼šdeleteä½¿ç”¨CSSé€‰æ‹©å™¨
[Custom] @Element WrongDelete from Base {
    delete .class-name;  // é”™è¯¯ï¼šdeleteä¸æ”¯æŒCSSé€‰æ‹©å™¨
    delete #id-name;     // é”™è¯¯ï¼šdeleteä¸æ”¯æŒCSSé€‰æ‹©å™¨
}
*/

// ============================================================================
// 2. æ­£ç¡®çš„è¾¹ç•Œæ¡ä»¶æµ‹è¯•
// ============================================================================

// 2.1 æœ€å°åŒ–è¯­æ³•æµ‹è¯•
html {
    body {
        text { æœ€ç®€å•çš„CHTLæ–‡æ¡£ }
    }
}

// 2.2 å¤æ‚åµŒå¥—æµ‹è¯•
[Template] @Style ComplexNesting {
    container: {
        width: 100%;
        max-width: 1200px;
        margin: 0 auto;
        
        // æ·±å±‚åµŒå¥—æ ·å¼
        header: {
            background: linear-gradient(
                135deg, 
                #667eea 0%, 
                #764ba2 100%
            );
            padding: 40px 0;
            
            nav: {
                display: flex;
                justify-content: space-between;
                align-items: center;
                
                ul: {
                    display: flex;
                    list-style: none;
                    
                    li: {
                        margin: 0 15px;
                        
                        a: {
                            color: white;
                            text-decoration: none;
                            transition: color 0.3s ease;
                        }
                        
                        "a:hover": {
                            color: #fbbf24;
                        }
                    }
                }
            }
        }
    }
}

// 2.3 æé•¿å­—ç¬¦ä¸²æµ‹è¯•
[Template] @Var LongStrings {
    veryLongString: "è¿™æ˜¯ä¸€ä¸ªéå¸¸éå¸¸éå¸¸éå¸¸éå¸¸éå¸¸éå¸¸éå¸¸éå¸¸éå¸¸éå¸¸éå¸¸éå¸¸éå¸¸éå¸¸éå¸¸éå¸¸éå¸¸éå¸¸éå¸¸éå¸¸éå¸¸éå¸¸éå¸¸éå¸¸éå¸¸éå¸¸éå¸¸éå¸¸éå¸¸éå¸¸éå¸¸éå¸¸éå¸¸éå¸¸éå¸¸éå¸¸éå¸¸éå¸¸éå¸¸é•¿çš„å­—ç¬¦ä¸²ï¼Œç”¨äºæµ‹è¯•CHTLç¼–è¯‘å™¨å¯¹é•¿å­—ç¬¦ä¸²çš„å¤„ç†èƒ½åŠ›";
    
    multiLineString: "è¿™æ˜¯ä¸€ä¸ª
    è·¨è¶Šå¤šè¡Œçš„
    å­—ç¬¦ä¸²å†…å®¹
    ç”¨äºæµ‹è¯•å¤šè¡Œå¤„ç†";
}

// 2.4 ç‰¹æ®Šå­—ç¬¦æµ‹è¯•
[Template] @Var SpecialChars {
    unicodeString: "æµ‹è¯•Unicodeå­—ç¬¦ï¼šğŸ¯ğŸš€ğŸ’âœ¨ğŸ‰";
    specialSymbols: "ç‰¹æ®Šç¬¦å·ï¼š@#$%^&*()_+-=[]{}|;':\",./<>?";
    chineseChars: "ä¸­æ–‡å­—ç¬¦æµ‹è¯•ï¼šä½ å¥½ä¸–ç•Œï¼";
    mixedContent: "Mixedå†…å®¹ï¼šHelloä¸–ç•Œ123ï¼@#$%";
}

// ============================================================================
// 3. è¾¹ç•Œæ¡ä»¶å’Œå‹åŠ›æµ‹è¯•
// ============================================================================

// 3.1 æ·±åº¦åµŒå¥—æµ‹è¯•
[Template] @Element DeepNesting {
    div {
        div {
            div {
                div {
                    div {
                        div {
                            div {
                                div {
                                    div {
                                        div {
                                            text { 10å±‚æ·±åº¦åµŒå¥—æµ‹è¯• }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}

// 3.2 å¤§é‡å±æ€§æµ‹è¯•
[Template] @Element ManyAttributes {
    div {
        id: test-element;
        class: primary secondary tertiary;
        data-value: 123;
        data-string: "test";
        data-boolean: true;
        data-array: "[1,2,3]";
        data-object: '{"key":"value"}';
        aria-label: "æµ‹è¯•å…ƒç´ ";
        aria-describedby: "description";
        aria-expanded: false;
        role: button;
        tabindex: 0;
        title: "æ‚¬åœæç¤º";
        lang: zh-CN;
        dir: ltr;
        contenteditable: false;
        draggable: true;
        hidden: false;
        spellcheck: true;
        translate: yes;
        
        text { å¤§é‡å±æ€§æµ‹è¯•å…ƒç´  }
    }
}

// 3.3 å¤æ‚CHTL JSæµ‹è¯•
[Template] @Element ComplexCHTLJS {
    div {
        class: complex-js-test;
        
        script {
            // å¤æ‚çš„è™šå¯¹è±¡å®šä¹‰
            vir ComplexManager = listen({
                init: function() {
                    console.log('å¤æ‚ç®¡ç†å™¨åˆå§‹åŒ–');
                    this.state = {
                        active: false,
                        count: 0,
                        items: []
                    };
                },
                
                addItem: function(item) {
                    this.state.items.push(item);
                    this.updateDisplay();
                },
                
                removeItem: function(index) {
                    this.state.items.splice(index, 1);
                    this.updateDisplay();
                },
                
                updateDisplay: function() {
                    {{.item-count}}->textContent = this.state.items.length;
                    {{.item-list}}->innerHTML = this.state.items
                        .map((item, index) => `<li data-index="${index}">${item}</li>`)
                        .join('');
                },
                
                handleComplexEvent: function(eventType, data) {
                    switch(eventType) {
                        case 'add':
                            this.addItem(data.item);
                            break;
                        case 'remove':
                            this.removeItem(data.index);
                            break;
                        case 'clear':
                            this.state.items = [];
                            this.updateDisplay();
                            break;
                        default:
                            console.warn('æœªçŸ¥äº‹ä»¶ç±»å‹:', eventType);
                    }
                }
            });
            
            // å¤æ‚çš„äº‹ä»¶å§”æ‰˜
            {{&}}->delegate({
                target: {{.action-button}},
                click: function(e) {
                    const action = {{this}}->getAttribute('data-action');
                    const value = {{this}}->getAttribute('data-value');
                    
                    ComplexManager->handleComplexEvent(action, {
                        item: value,
                        index: parseInt(value) || 0
                    });
                }
            });
            
            // å¤æ‚çš„åŠ¨ç”»åºåˆ—
            {{.animate-trigger}}->listen({
                click: function() {
                    const targets = [
                        {{.anim-1}},
                        {{.anim-2}},
                        {{.anim-3}}
                    ];
                    
                    targets.forEach((target, index) => {
                        setTimeout(() => {
                            animate({
                                target: target,
                                duration: 500,
                                delay: index * 100,
                                easing: 'cubic-bezier(0.4, 0, 0.2, 1)',
                                properties: {
                                    opacity: [0, 1],
                                    transform: [
                                        'translateY(30px) scale(0.8)', 
                                        'translateY(0) scale(1)'
                                    ]
                                },
                                onComplete: function() {
                                    if (index === targets.length - 1) {
                                        console.log('æ‰€æœ‰åŠ¨ç”»å®Œæˆ');
                                    }
                                }
                            });
                        }, index * 50);
                    });
                }
            });
            
            // åˆå§‹åŒ–å¤æ‚ç®¡ç†å™¨
            ComplexManager->init();
        }
        
        style {
            .complex-js-test {
                border: 3px solid #8b5cf6;
                padding: 30px;
                margin: 30px 0;
                border-radius: 12px;
                background: #faf5ff;
            }
            
            .action-button {
                background: #8b5cf6;
                color: white;
                border: none;
                padding: 8px 16px;
                margin: 5px;
                border-radius: 4px;
                cursor: pointer;
            }
            
            .action-button:hover {
                background: #7c3aed;
            }
            
            .anim-1, .anim-2, .anim-3 {
                width: 50px;
                height: 50px;
                background: #8b5cf6;
                margin: 10px;
                border-radius: 50%;
                display: inline-block;
                opacity: 0;
            }
        }
        
        h3 {
            text { å¤æ‚CHTL JSæµ‹è¯• }
            color: #7c3aed;
            margin-bottom: 20px;
        }
        
        div {
            class: controls;
            
            button {
                class: action-button;
                data-action: add;
                data-value: "æ–°é¡¹ç›®";
                text { æ·»åŠ é¡¹ç›® }
            }
            
            button {
                class: action-button;
                data-action: remove;
                data-value: "0";
                text { åˆ é™¤é¡¹ç›® }
            }
            
            button {
                class: action-button;
                data-action: clear;
                text { æ¸…ç©ºåˆ—è¡¨ }
            }
            
            button {
                class: action-button animate-trigger;
                text { è§¦å‘åŠ¨ç”» }
            }
        }
        
        div {
            class: display;
            
            p {
                text { é¡¹ç›®æ•°é‡: }
                span {
                    class: item-count;
                    text { 0 }
                }
            }
            
            ul {
                class: item-list;
                // åŠ¨æ€å†…å®¹å°†é€šè¿‡JavaScriptå¡«å……
            }
        }
        
        div {
            class: animation-targets;
            
            div { class: anim-1; }
            div { class: anim-2; }
            div { class: anim-3; }
        }
    }
}

// ============================================================================
// 4. æ¨¡å—ç³»ç»Ÿç»“æ„æµ‹è¯•ï¼ˆæ¦‚å¿µæ¼”ç¤ºï¼‰
// ============================================================================

// 4.1 æ¨¡å—ä¿¡æ¯æ ¼å¼æµ‹è¯•
[Info] {
    name = "ComprehensiveTestModule";
    version = "1.0.0";
    description = "CHTLè¯­æ³•å…¨é¢æµ‹è¯•æ¨¡å—";
    author = "CHTLæµ‹è¯•å›¢é˜Ÿ";
    license = "MIT";
    category = "æµ‹è¯•ç»„ä»¶";
    minCHTLVersion = "1.0.0";
    maxCHTLVersion = "2.0.0";
    keywords = "test,syntax,comprehensive";
    homepage = "https://chtl-lang.org";
    repository = "https://github.com/chtl-lang/chtl";
}

// 4.2 å¯¼å‡ºå£°æ˜æµ‹è¯•
[Export] {
    [Custom] @Element InteractiveCard;
    [Template] @Style ButtonBase;
    [Template] @Style ButtonPrimary;
    [Custom] @Var AppTheme;
    [Template] @Var ThemeColors;
    [Origin] @Html CustomHeader;
    [Origin] @JavaScript Utils;
    [Custom] @Style FlexLayout;
}

// ============================================================================
// 5. é«˜çº§ç‰¹æ€§ç»¼åˆæµ‹è¯•
// ============================================================================

// 5.1 å…¨ç¼€åè®¿é—®æµ‹è¯•ï¼ˆæ¦‚å¿µæ¼”ç¤ºï¼‰
/*
// è¿™äº›åœ¨å®é™…ä½¿ç”¨ä¸­éœ€è¦å¯¹åº”çš„å‘½åç©ºé—´å­˜åœ¨
div {
    text { å…¨ç¼€åè®¿é—®æµ‹è¯• }
    
    // è®¿é—®ç‰¹å®šå‘½åç©ºé—´çš„å…ƒç´ 
    UI::Components::Button
    Theme::Dark::Colors
    
    // è®¿é—®ç‰¹å®šæ¨¡å—çš„ç»„ä»¶
    Chtholly::ChthollyButton
    Yuigahama::YuigahamaCard
}
*/

// 5.2 æ¡ä»¶ç¼–è¯‘æµ‹è¯•ï¼ˆæ¦‚å¿µæ¼”ç¤ºï¼‰
[Configuration] @Config TestEnvironment {
    ENABLE_DEBUG = true;
    ENABLE_ANALYTICS = false;
    API_ENDPOINT = "https://test-api.example.com";
}

// 5.3 å¤æ‚æ¨¡æ¿ç»„åˆæµ‹è¯•
[Template] @Element ComplexComponent {
    article {
        class: complex-component;
        
        style {
            .complex-component {
                background: white;
                border-radius: 12px;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                overflow: hidden;
                margin: 20px 0;
            }
            
            .component-header {
                background: linear-gradient(90deg, #3b82f6, #1d4ed8);
                color: white;
                padding: 20px;
            }
            
            .component-body {
                padding: 30px;
            }
            
            .component-footer {
                background: #f8fafc;
                padding: 15px 30px;
                border-top: 1px solid #e2e8f0;
            }
        }
        
        header {
            class: component-header;
            
            h2 {
                text { å¤æ‚ç»„ä»¶æ ‡é¢˜ }
                margin: 0;
                font-size: 1.5rem;
            }
            
            p {
                text { ç»„ä»¶æè¿°ä¿¡æ¯ }
                margin: 5px 0 0 0;
                opacity: 0.9;
            }
        }
        
        div {
            class: component-body;
            
            // åµŒå¥—ä½¿ç”¨å…¶ä»–æ¨¡æ¿
            Card
            
            div {
                class: nested-content;
                
                style {
                    .nested-content {
                        background: #f0f9ff;
                        padding: 20px;
                        border-radius: 8px;
                        margin: 20px 0;
                    }
                }
                
                h3 {
                    text { åµŒå¥—å†…å®¹åŒºåŸŸ }
                    color: #1e40af;
                }
                
                p {
                    text { è¿™é‡Œå±•ç¤ºäº†å¤æ‚çš„æ¨¡æ¿åµŒå¥—å’Œç»„åˆä½¿ç”¨ }
                }
                
                // æµ‹è¯•å¤æ‚çš„CHTL JS
                button {
                    class: complex-interaction-btn;
                    
                    style {
                        .complex-interaction-btn {
                            background: #059669;
                            color: white;
                            border: none;
                            padding: 10px 20px;
                            border-radius: 6px;
                            cursor: pointer;
                            margin-top: 15px;
                        }
                    }
                    
                    script {
                        vir InteractionManager = listen({
                            setup: function() {
                                this.clickCount = 0;
                                this.startTime = Date.now();
                            },
                            
                            handleClick: function() {
                                this.clickCount++;
                                const elapsed = Date.now() - this.startTime;
                                
                                {{&}}->textContent = `ç‚¹å‡»äº†${this.clickCount}æ¬¡ (${elapsed}ms)`;
                                
                                // å¤æ‚çš„åŠ¨ç”»æ•ˆæœ
                                animate({
                                    target: {{&}},
                                    duration: 200,
                                    properties: {
                                        transform: ['scale(1)', 'scale(0.95)', 'scale(1)'],
                                        background: ['#059669', '#10b981', '#059669']
                                    }
                                });
                                
                                // æ›´æ–°çˆ¶å®¹å™¨
                                {{.nested-content}}->style->borderColor = 
                                    this.clickCount % 2 === 0 ? '#3b82f6' : '#10b981';
                            }
                        });
                        
                        InteractionManager->setup();
                        
                        {{&}}->listen({
                            click: function(e) {
                                InteractionManager->handleClick();
                            },
                            
                            mouseenter: function(e) {
                                {{&}}->style->transform = 'translateY(-2px)';
                            },
                            
                            mouseleave: function(e) {
                                {{&}}->style->transform = 'translateY(0)';
                            }
                        });
                    }
                    
                    text { å¤æ‚äº¤äº’æŒ‰é’® }
                }
            }
        }
        
        footer {
            class: component-footer;
            
            div {
                class: footer-actions;
                
                style {
                    .footer-actions {
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                    }
                    
                    .footer-button {
                        background: #6b7280;
                        color: white;
                        border: none;
                        padding: 8px 16px;
                        border-radius: 4px;
                        cursor: pointer;
                        font-size: 0.9rem;
                    }
                    
                    .footer-button:hover {
                        background: #4b5563;
                    }
                }
                
                button {
                    class: footer-button;
                    text { å–æ¶ˆ }
                }
                
                button {
                    class: footer-button;
                    style {
                        background: #3b82f6;
                    }
                    text { ç¡®è®¤ }
                }
            }
        }
    }
}

// ============================================================================
// 6. å®é™…ä½¿ç”¨æµ‹è¯•
// ============================================================================

html {
    lang: zh-CN;
    
    head {
        meta { charset: UTF-8; }
        meta { 
            name: viewport; 
            content: "width=device-width, initial-scale=1.0"; 
        }
        title { 
            text { CHTLé”™è¯¯å¤„ç†å’Œè¾¹ç•Œæ¡ä»¶æµ‹è¯• } 
        }
    }
    
    body {
        style {
            body {
                margin: 0;
                padding: 0;
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
                background: #f9fafb;
            }
        }
        
        header {
            class: test-header;
            
            style {
                .test-header {
                    background: #1f2937;
                    color: white;
                    padding: 30px 0;
                    text-align: center;
                }
            }
            
            h1 {
                text { CHTLé”™è¯¯å¤„ç†æµ‹è¯• }
                margin: 0;
            }
            
            p {
                text { æµ‹è¯•è¾¹ç•Œæ¡ä»¶ã€é”™è¯¯æ£€æµ‹å’Œå¤æ‚è¯­æ³• }
                margin: 10px 0 0 0;
                opacity: 0.8;
            }
        }
        
        main {
            class: test-content;
            
            style {
                .test-content {
                    max-width: 1200px;
                    margin: 0 auto;
                    padding: 40px 20px;
                }
            }
            
            section {
                class: test-section;
                
                style {
                    .test-section {
                        background: white;
                        border-radius: 8px;
                        padding: 30px;
                        margin: 30px 0;
                        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                    }
                }
                
                h2 {
                    text { è¾¹ç•Œæ¡ä»¶æµ‹è¯• }
                    color: #7c3aed;
                    margin-bottom: 20px;
                }
                
                // ä½¿ç”¨å¤æ‚ç»„ä»¶
                ComplexComponent
                
                // ä½¿ç”¨æ·±åº¦åµŒå¥—ç»„ä»¶
                DeepNesting
                
                // ä½¿ç”¨å¤§é‡å±æ€§ç»„ä»¶
                ManyAttributes
                
                // æµ‹è¯•å˜é‡ç»„çš„å¤æ‚ä½¿ç”¨
                div {
                    class: variable-test;
                    
                    style {
                        .variable-test {
                            color: ThemeColors(primaryColor);
                            background: ThemeColors(accentColor);
                            border: 2px solid ThemeColors(dangerColor);
                            padding: Spacing(large);
                            margin: Spacing(medium) 0;
                            border-radius: 8px;
                        }
                    }
                    
                    text { å¤æ‚å˜é‡ç»„ä½¿ç”¨æµ‹è¯• }
                }
                
                // æµ‹è¯•ç‰¹æ®Šå­—ç¬¦å¤„ç†
                div {
                    class: special-chars-test;
                    
                    style {
                        .special-chars-test {
                            background: #fef3c7;
                            padding: 20px;
                            border-radius: 8px;
                            margin: 20px 0;
                            font-family: 'Courier New', monospace;
                        }
                    }
                    
                    h3 {
                        text { ç‰¹æ®Šå­—ç¬¦æµ‹è¯• }
                    }
                    
                    p {
                        text { Unicodeå­—ç¬¦ï¼šğŸ¯ğŸš€ğŸ’âœ¨ğŸ‰ }
                    }
                    
                    p {
                        text { ç‰¹æ®Šç¬¦å·ï¼š@#$%^&*()_+-=[]{}|;':\",./<>? }
                    }
                    
                    p {
                        text { ä¸­æ–‡å­—ç¬¦ï¼šä½ å¥½ä¸–ç•Œï¼æµ‹è¯•ä¸­æ–‡å¤„ç†èƒ½åŠ› }
                    }
                    
                    p {
                        text { Mixedå†…å®¹ï¼šHelloä¸–ç•Œ123ï¼@#$% }
                    }
                }
            }
        }
        
        footer {
            class: test-footer;
            
            style {
                .test-footer {
                    background: #374151;
                    color: white;
                    text-align: center;
                    padding: 30px 0;
                    margin-top: 60px;
                }
            }
            
            p {
                text { CHTLé”™è¯¯å¤„ç†å’Œè¾¹ç•Œæ¡ä»¶æµ‹è¯•å®Œæˆ }
                margin: 0;
            }
        }
    }
}