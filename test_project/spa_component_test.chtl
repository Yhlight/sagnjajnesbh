// SPA组件测试 - 不强制html根节点，严格按照语法文档

// 变量组模板 - 语法文档第221-229行
[Template] @Var ComponentColors
{
    primary: "#007bff";
    secondary: "#6c757d";
    success: "#28a745";
}

// 自定义样式组 - 语法文档第294-325行
[Custom] @Style CardStyle
{
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    padding: 20px;
    margin: 10px;
}

// 自定义元素 - 语法文档第326-390行
[Custom] @Element UserCard
{
    div
    {
        class: user-card;
        
        style
        {
            @Style CardStyle;
            
            .user-avatar
            {
                width: 60px;
                height: 60px;
                border-radius: 50%;
                background-color: ComponentColors(secondary);
            }
            
            .user-name
            {
                color: ComponentColors(primary);
                font-size: 18px;
                font-weight: bold;
                margin: 10px 0;
            }
            
            &:hover
            {
                transform: translateY(-2px);
                box-shadow: 0 4px 8px rgba(0,0,0,0.15);
                transition: all 0.3s ease;
            }
        }
        
        div
        {
            class: user-avatar;
        }
        
        div
        {
            class: user-info;
            
            h3
            {
                class: user-name;
                
                text
                {
                    用户姓名
                }
            }
            
            p
            {
                class: user-bio;
                
                text
                {
                    这是用户的个人简介
                }
                
                style
                {
                    color: ComponentColors(secondary);
                    font-size: 14px;
                    line-height: 1.4;
                }
            }
        }
        
        script
        {
            // CHTL JS语法 - 增强选择器和监听器 (语法文档第1130-1213行)
            {{.user-card}}->listen({
                click: () => {
                    console.log('用户卡片被点击');
                    
                    // 使用动画 - 语法文档第1233-1272行
                    const cardAnim = animate({
                        target: {{.user-card}},
                        duration: 200,
                        easing: 'ease-out',
                        
                        begin: {
                            transform: 'scale(1.0)'
                        },
                        
                        when: [
                            {
                                at: 0.5;
                                transform: 'scale(1.02)',
                                background: ComponentColors(success)
                            }
                        ],
                        
                        end: {
                            transform: 'scale(1.0)',
                            background: 'white'
                        }
                    });
                },
                
                mouseenter: () => {
                    {{.user-name}}->style->color = ComponentColors(success);
                }
            });
            
            // 事件委托 - 语法文档第1215-1231行
            {{document.body}}->delegate({
                target: [{{.user-card}}, {{.user-avatar}}],
                dblclick: () => {
                    console.log('用户卡片双击 - 通过事件委托');
                }
            });
            
            // 虚对象 - 语法文档第1274-1299行
            vir CardController = listen({
                show: () => {
                    {{.user-card}}->style->display = 'block';
                },
                
                hide: () => {
                    {{.user-card}}->style->display = 'none';
                },
                
                highlight: () => {
                    {{.user-card}}->style->backgroundColor = ComponentColors(primary);
                }
            });
            
            // 初始化
            CardController->show();
        }
    }
}

// 主要组件区域 - SPA组件，不需要html根节点
div
{
    class: spa-container;
    
    style
    {
        .spa-container
        {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto;
        }
        
        .header
        {
            text-align: center;
            margin-bottom: 30px;
            color: ComponentColors(primary);
        }
    }
    
    div
    {
        class: header;
        
        h1
        {
            text
            {
                SPA组件演示
            }
        }
        
        p
        {
            text
            {
                这是一个SPA组件，不包含html根节点
            }
        }
    }
    
    // 使用自定义元素
    @Element UserCard;
    
    // 演示删除操作 - 语法文档第519-583行
    @Element UserCard
    {
        delete .user-bio;  // 删除用户简介部分
    }
    
    // 演示插入操作 - 语法文档第477-517行  
    @Element UserCard
    {
        insert after .user-name {
            span
            {
                class: user-badge;
                
                text
                {
                    VIP
                }
                
                style
                {
                    background-color: ComponentColors(success);
                    color: white;
                    padding: 2px 8px;
                    border-radius: 12px;
                    font-size: 12px;
                    margin-left: 10px;
                }
            }
        }
    }
}

// 约束演示 - 语法文档第1062-1097行
[Custom] @Element SafeContainer
{
    div
    {
        except script, iframe;  // 安全约束：禁止脚本和iframe
        
        div
        {
            class: safe-content;
            
            text
            {
                这是安全的内容区域
            }
        }
    }
}