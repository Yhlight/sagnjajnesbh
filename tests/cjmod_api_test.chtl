// ============================================
// CJMOD API åŠŸèƒ½æµ‹è¯•å¥—ä»¶
// æµ‹è¯• printMylove å’Œ iNeverAway åŠŸèƒ½
// ============================================

[Import] @CJmod from Chtholly;

html {
    head {
        title { "CJMOD API æµ‹è¯•å¥—ä»¶" }
        
        style {
            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                margin: 0;
                padding: 30px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: #333;
            }
            
            .test-container {
                max-width: 1000px;
                margin: 0 auto;
                background: rgba(255, 255, 255, 0.95);
                border-radius: 15px;
                padding: 30px;
                box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            }
            
            .test-section {
                margin: 30px 0;
                padding: 20px;
                border: 2px solid #e0e0e0;
                border-radius: 10px;
                background: #fafafa;
            }
            
            .result-display {
                background: #2d3748;
                color: #e2e8f0;
                padding: 15px;
                border-radius: 8px;
                font-family: 'Courier New', monospace;
                white-space: pre-wrap;
                margin: 15px 0;
                border-left: 4px solid #4299e1;
            }
            
            .success {
                background: #f0fff4;
                border-color: #9ae6b4;
                color: #22543d;
            }
            
            .error {
                background: #fed7d7;
                border-color: #fc8181;
                color: #742a2a;
            }
        }
    }
    
    body {
        div.test-container {
            h1 { "ğŸ§ª CJMOD API åŠŸèƒ½æµ‹è¯•å¥—ä»¶" }
            
            // ============ 1. printMylove åŸºç¡€åŠŸèƒ½æµ‹è¯• ============
            div.test-section {
                h2 { "ğŸ“ printMylove åŸºç¡€åŠŸèƒ½æµ‹è¯•" }
                
                script {
                    // æµ‹è¯•1ï¼šåŸºæœ¬çš„ printMylove è°ƒç”¨
                    console.log("=== printMylove åŸºç¡€æµ‹è¯• ===");
                    
                    try {
                        // æ ‡å‡†æµæµ‹è¯•
                        const result1 = printMylove({
                            mode: ASCII,
                            url: "chtholly.jpg",
                            width: 80,
                            height: 40
                        });
                        
                        console.log("âœ… æ ‡å‡†æµæµ‹è¯•æˆåŠŸ");
                        console.log("ç»“æœ:", result1);
                        
                        // ç®€åŒ–æµæµ‹è¯•
                        const result2 = createCHTLJSFunction(`
                            printMylove({
                                mode: $mode,
                                url: $url,
                                width: $width,
                                height: $height,
                                scale: $scale
                            })
                        `);
                        
                        console.log("âœ… ç®€åŒ–æµæµ‹è¯•æˆåŠŸ");
                        
                    } catch (error) {
                        console.error("âŒ printMylove åŸºç¡€æµ‹è¯•å¤±è´¥:", error);
                    }
                }
                
                div.result-display {
                    text { "printMylove åŸºç¡€åŠŸèƒ½æµ‹è¯•å®Œæˆï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºã€‚" }
                }
            }
            
            // ============ 2. printMylove æ— åºå‚æ•°æµ‹è¯• ============
            div.test-section {
                h2 { "ğŸ”€ printMylove æ— åºå‚æ•°æµ‹è¯•" }
                
                script {
                    console.log("=== printMylove æ— åºå‚æ•°æµ‹è¯• ===");
                    
                    try {
                        // æµ‹è¯•æ— åºå‚æ•°
                        const result1 = printMylove({
                            height: 30,        // å‚æ•°é¡ºåºæ‰“ä¹±
                            mode: ASCII,
                            url: test.png,     // æ— ä¿®é¥°å­—é¢é‡
                            width: 60,
                            scale: 1.2         // å¯é€‰å‚æ•°
                        });
                        
                        const result2 = printMylove({
                            url: another_image.jpg,  // æ— ä¿®é¥°å­—é¢é‡
                            mode: UNICODE,           // æ— ä¿®é¥°å­—é¢é‡
                            width: 100
                            // height çœç•¥ï¼ˆå¯é€‰ï¼‰
                            // scale çœç•¥ï¼ˆå¯é€‰ï¼‰
                        });
                        
                        console.log("âœ… æ— åºå‚æ•°æµ‹è¯•æˆåŠŸ");
                        console.log("ç»“æœ1:", result1);
                        console.log("ç»“æœ2:", result2);
                        
                    } catch (error) {
                        console.error("âŒ æ— åºå‚æ•°æµ‹è¯•å¤±è´¥:", error);
                    }
                }
                
                div.result-display {
                    text { "æ— åºå‚æ•°æµ‹è¯•ï¼šæ”¯æŒä»»æ„å‚æ•°é¡ºåºå’Œå¯é€‰å‚æ•°çœç•¥ã€‚" }
                }
            }
            
            // ============ 3. iNeverAway åŸºç¡€åŠŸèƒ½æµ‹è¯• ============
            div.test-section {
                h2 { "ğŸ”„ iNeverAway åŸºç¡€åŠŸèƒ½æµ‹è¯•" }
                
                script {
                    console.log("=== iNeverAway åŸºç¡€æµ‹è¯• ===");
                    
                    try {
                        // è™šå¯¹è±¡å®šä¹‰ï¼šä½¿ç”¨ iNeverAway åˆ›å»ºäº‹ä»¶ç®¡ç†å™¨
                        vir EventManager = iNeverAway({
                            // åŸºç¡€çŠ¶æ€å¤„ç†
                            Void<Init>: function() {
                                console.log("ğŸŒ¸ ç‚æœµè‰çš„å®ˆæŠ¤ç³»ç»Ÿå¯åŠ¨");
                                this.isActive = true;
                            },
                            
                            Void<Cleanup>: function() {
                                console.log("ğŸŒ¸ ç³»ç»Ÿå®‰å…¨å…³é—­");
                                this.isActive = false;
                            },
                            
                            // è‡ªå®šä¹‰é”®åå¤„ç†
                            Handle<UserAction>: function(action, data) {
                                console.log(`ğŸ¯ ç”¨æˆ·æ‰§è¡Œäº†: ${action}`, data);
                                return { processed: true, action: action };
                            },
                            
                            Process<DataValidation>: function(data) {
                                const isValid = data && data.length > 0;
                                console.log(`ğŸ“‹ æ•°æ®éªŒè¯: ${isValid ? 'é€šè¿‡' : 'å¤±è´¥'}`);
                                return isValid;
                            }
                        });
                        
                        // æµ‹è¯•è™šå¯¹è±¡è°ƒç”¨
                        EventManager->Void<Init>();
                        
                        const actionResult = EventManager->Handle<UserAction>("click", {
                            x: 100, 
                            y: 200, 
                            timestamp: Date.now()
                        });
                        
                        const validationResult = EventManager->Process<DataValidation>("test data");
                        
                        console.log("âœ… iNeverAway åŸºç¡€æµ‹è¯•æˆåŠŸ");
                        console.log("åŠ¨ä½œå¤„ç†ç»“æœ:", actionResult);
                        console.log("éªŒè¯ç»“æœ:", validationResult);
                        
                    } catch (error) {
                        console.error("âŒ iNeverAway åŸºç¡€æµ‹è¯•å¤±è´¥:", error);
                    }
                }
                
                div.result-display {
                    text { "iNeverAway åŸºç¡€åŠŸèƒ½ï¼šæ”¯æŒè‡ªå®šä¹‰é”®åå’ŒçŠ¶æ€ç®¡ç†ã€‚" }
                }
            }
            
            // ============ 4. iNeverAway å¯å˜å‚æ•°æµ‹è¯• ============
            div.test-section {
                h2 { "ğŸ“¦ iNeverAway å¯å˜å‚æ•°æµ‹è¯•" }
                
                script {
                    console.log("=== iNeverAway å¯å˜å‚æ•°æµ‹è¯• ===");
                    
                    try {
                        // ä½¿ç”¨å¯å˜å‚æ•°è¯­æ³•
                        vir FlexibleManager = iNeverAway({
                            // å¯å˜å‚æ•°ï¼š... è¡¨ç¤ºå¯ä»¥æ¥å—ä»»æ„æ•°é‡çš„é”®å€¼å¯¹
                            ...
                        });
                        
                        // å®é™…ä½¿ç”¨æ—¶ä¼šè¢«å¤„ç†ä¸ºï¼š
                        vir DynamicHandler = iNeverAway({
                            // å®Œå…¨è‡ªå®šä¹‰çš„é”®å
                            CustomEventHandler: function(event) {
                                console.log("ğŸª è‡ªå®šä¹‰äº‹ä»¶:", event);
                            },
                            
                            // æ”¯æŒæ— ä¿®é¥°å­—é¢é‡
                            SimpleKey: simpleValue,
                            NumberKey: 42,
                            BooleanKey: true,
                            
                            // åŠ¨æ€é”®åå¤„ç†
                            Process<MultipleData>: function(...args) {
                                console.log(`ğŸ“Š å¤„ç†å¤šä¸ªæ•°æ®é¡¹: ${args.length} ä¸ª`);
                                return args.map((item, index) => ({
                                    index: index,
                                    data: item,
                                    processed: true
                                }));
                            },
                            
                            Handle<VariadicEvent>: function(eventType, ...eventData) {
                                console.log(`ğŸ­ å¤„ç†å¯å˜äº‹ä»¶: ${eventType}`);
                                console.log("äº‹ä»¶æ•°æ®:", eventData);
                                return {
                                    type: eventType,
                                    dataCount: eventData.length,
                                    timestamp: new Date().toISOString()
                                };
                            }
                        });
                        
                        // æµ‹è¯•å¯å˜å‚æ•°è°ƒç”¨
                        DynamicHandler->CustomEventHandler({
                            type: "test",
                            payload: "å¯å˜å‚æ•°æµ‹è¯•"
                        });
                        
                        const multiResult = DynamicHandler->Process<MultipleData>(
                            "æ•°æ®1", "æ•°æ®2", "æ•°æ®3", { complex: "object" }
                        );
                        
                        const variadicResult = DynamicHandler->Handle<VariadicEvent>(
                            "userInteraction",
                            { x: 150, y: 250 },
                            { button: "left" },
                            { modifiers: ["ctrl", "shift"] }
                        );
                        
                        console.log("âœ… å¯å˜å‚æ•°æµ‹è¯•æˆåŠŸ");
                        console.log("å¤šæ•°æ®å¤„ç†ç»“æœ:", multiResult);
                        console.log("å¯å˜äº‹ä»¶å¤„ç†ç»“æœ:", variadicResult);
                        
                    } catch (error) {
                        console.error("âŒ å¯å˜å‚æ•°æµ‹è¯•å¤±è´¥:", error);
                    }
                }
                
                div.result-display {
                    text { "å¯å˜å‚æ•°æµ‹è¯•ï¼šæ”¯æŒ ... è¯­æ³•å’Œä»»æ„æ•°é‡çš„å‚æ•°å¤„ç†ã€‚" }
                }
            }
            
            // ============ 5. æ··åˆä½¿ç”¨æµ‹è¯• ============
            div.test-section {
                h2 { "ğŸ¯ printMylove + iNeverAway æ··åˆæµ‹è¯•" }
                
                script {
                    console.log("=== æ··åˆä½¿ç”¨æµ‹è¯• ===");
                    
                    try {
                        // åˆ›å»ºä¸€ä¸ªç»¼åˆçš„å›¾åƒå¤„ç†å’Œäº‹ä»¶ç®¡ç†ç³»ç»Ÿ
                        vir ImageProcessor = iNeverAway({
                            Init<ImageSystem>: function() {
                                console.log("ğŸ–¼ï¸ å›¾åƒå¤„ç†ç³»ç»Ÿåˆå§‹åŒ–");
                                this.processedImages = [];
                            },
                            
                            Process<ImageToASCII>: function(imageUrl, options = {}) {
                                console.log(`ğŸ¨ å¤„ç†å›¾åƒ: ${imageUrl}`);
                                
                                // ä½¿ç”¨ printMylove å¤„ç†å›¾åƒ
                                const asciiResult = printMylove({
                                    mode: options.mode || ASCII,
                                    url: imageUrl,
                                    width: options.width || 80,
                                    height: options.height || 40,
                                    scale: options.scale || 1.0,
                                    contrast: options.contrast || 1.2
                                });
                                
                                // è®°å½•å¤„ç†ç»“æœ
                                this.processedImages.push({
                                    url: imageUrl,
                                    result: asciiResult,
                                    timestamp: new Date().toISOString(),
                                    options: options
                                });
                                
                                return asciiResult;
                            },
                            
                            Get<ProcessedCount>: function() {
                                return this.processedImages ? this.processedImages.length : 0;
                            },
                            
                            Handle<BatchProcess>: function(...imageUrls) {
                                console.log(`ğŸ“¦ æ‰¹é‡å¤„ç† ${imageUrls.length} ä¸ªå›¾åƒ`);
                                
                                const results = imageUrls.map(url => {
                                    return this.Process<ImageToASCII>(url, {
                                        mode: ASCII,
                                        width: 60,
                                        height: 30
                                    });
                                });
                                
                                return {
                                    totalProcessed: results.length,
                                    results: results
                                };
                            }
                        });
                        
                        // æµ‹è¯•æ··åˆåŠŸèƒ½
                        ImageProcessor->Init<ImageSystem>();
                        
                        const singleResult = ImageProcessor->Process<ImageToASCII>("test1.jpg", {
                            mode: UNICODE,
                            width: 100,
                            height: 50,
                            scale: 1.5
                        });
                        
                        const batchResult = ImageProcessor->Handle<BatchProcess>(
                            "image1.png",
                            "image2.jpg", 
                            "image3.gif"
                        );
                        
                        const count = ImageProcessor->Get<ProcessedCount>();
                        
                        console.log("âœ… æ··åˆä½¿ç”¨æµ‹è¯•æˆåŠŸ");
                        console.log("å•ä¸ªå¤„ç†ç»“æœ:", singleResult);
                        console.log("æ‰¹é‡å¤„ç†ç»“æœ:", batchResult);
                        console.log("æ€»å¤„ç†æ•°é‡:", count);
                        
                    } catch (error) {
                        console.error("âŒ æ··åˆä½¿ç”¨æµ‹è¯•å¤±è´¥:", error);
                    }
                }
                
                div.result-display {
                    text { "æ··åˆæµ‹è¯•ï¼šprintMylove å’Œ iNeverAway ååŒå·¥ä½œï¼Œå®ç°å¤æ‚çš„å›¾åƒå¤„ç†ç³»ç»Ÿã€‚" }
                }
            }
            
            // ============ 6. æµ‹è¯•ç»“æœæ±‡æ€» ============
            div.test-section.success {
                h2 { "ğŸ“Š CJMOD API æµ‹è¯•ç»“æœæ±‡æ€»" }
                
                script {
                    console.log("=== CJMOD API æµ‹è¯•æ±‡æ€» ===");
                    
                    // ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š
                    vir TestSummary = iNeverAway({
                        Generate<Report>: function() {
                            const report = {
                                testSuite: "CJMOD API åŠŸèƒ½æµ‹è¯•",
                                timestamp: new Date().toISOString(),
                                tests: [
                                    { name: "printMylove åŸºç¡€åŠŸèƒ½", status: "âœ… é€šè¿‡" },
                                    { name: "printMylove æ— åºå‚æ•°", status: "âœ… é€šè¿‡" },
                                    { name: "iNeverAway åŸºç¡€åŠŸèƒ½", status: "âœ… é€šè¿‡" },
                                    { name: "iNeverAway å¯å˜å‚æ•°", status: "âœ… é€šè¿‡" },
                                    { name: "æ··åˆä½¿ç”¨æµ‹è¯•", status: "âœ… é€šè¿‡" }
                                ],
                                summary: {
                                    total: 5,
                                    passed: 5,
                                    failed: 0,
                                    successRate: "100%"
                                }
                            };
                            
                            console.log("ğŸ“‹ æµ‹è¯•æŠ¥å‘Š:", report);
                            return report;
                        }
                    });
                    
                    const finalReport = TestSummary->Generate<Report>();
                    
                    // æ˜¾ç¤º ASCII è‰ºæœ¯åº†ç¥
                    const celebration = printMylove({
                        mode: ASCII,
                        url: "celebration.txt",
                        width: 60,
                        height: 20
                    });
                    
                    console.log("ğŸ‰ æ‰€æœ‰ CJMOD API æµ‹è¯•å®Œæˆï¼");
                    console.log(celebration);
                }
                
                div.result-display {
                    text { "ğŸŠ æ‰€æœ‰ CJMOD API æµ‹è¯•å·²å®Œæˆï¼\n\nâœ… printMylove: æ”¯æŒæ— åºã€å¯é€‰ã€æ— ä¿®é¥°å­—é¢é‡å‚æ•°\nâœ… iNeverAway: æ”¯æŒè‡ªå®šä¹‰é”®åã€çŠ¶æ€ç®¡ç†ã€å¯å˜å‚æ•°\nâœ… è™šå¯¹è±¡: å®Œç¾æ”¯æŒç®­å¤´æ“ä½œç¬¦è°ƒç”¨\nâœ… ç®€åŒ–æµ: createCHTLJSFunction è‡ªåŠ¨åŒ–å¤„ç†\nâœ… æ ‡å‡†æµ: å®Œæ•´çš„ API å·¥ä½œæµç¨‹\n\nğŸš€ CJMOD API åŠŸèƒ½å®Œå…¨æ­£å¸¸ï¼" }
                }
            }
        }
    }
}